"use strict";(globalThis.webpackChunktimposu=globalThis.webpackChunktimposu||[]).push([[4404],{28453(e,n,t){t.d(n,{R:()=>i,x:()=>o});var r=t(96540);const a={},s=r.createContext(a);function i(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),r.createElement(s.Provider,{value:n},e.children)}},33447(e,n,t){t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"springboot/springboot-mvc-security/jdbc-auth-custom-table","title":"JDBC Auth Custom Tables","description":"Materi ini akan membahas cara mengonfigurasi Spring Security JDBC jika kita memiliki struktur tabel database sendiri yang berbeda dari standar default Spring.","source":"@site/tutorial/spring/springboot/springboot-mvc-security/10-jdbc-auth-custom-table.md","sourceDirName":"springboot/springboot-mvc-security","slug":"/springboot/springboot-mvc-security/jdbc-auth-custom-table","permalink":"/spring/springboot/springboot-mvc-security/jdbc-auth-custom-table","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"title":"JDBC Auth Custom Tables"},"sidebar":"tutorialSidebar","previous":{"title":"JDBC Authentication BCrypt","permalink":"/spring/springboot/springboot-mvc-security/jdbc-authentication-bcrypt"},"next":{"title":"Spring Boot JPA/Hibernate","permalink":"/spring/springboot/springboot-jpa-hibernate/"}}');var a=t(74848),s=t(28453);const i={sidebar_position:10,title:"JDBC Auth Custom Tables"},o=void 0,u={},c=[{value:"1\ufe0f\u20e3 Mengapa Menggunakan Custom Tables?",id:"1\ufe0f\u20e3-mengapa-menggunakan-custom-tables",level:2},{value:"2\ufe0f\u20e3 Contoh Skema Database Kustom",id:"2\ufe0f\u20e3-contoh-skema-database-kustom",level:2},{value:"3\ufe0f\u20e3 Konfigurasi: Menggunakan Custom Query",id:"3\ufe0f\u20e3-konfigurasi-menggunakan-custom-query",level:2},{value:"4\ufe0f\u20e3 Hal Penting yang Harus Diperhatikan",id:"4\ufe0f\u20e3-hal-penting-yang-harus-diperhatikan",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["Materi ini akan membahas cara mengonfigurasi ",(0,a.jsx)(n.strong,{children:"Spring Security JDBC"})," jika kita memiliki struktur tabel database sendiri yang berbeda dari standar default Spring."]}),"\n",(0,a.jsxs)(n.p,{children:["Di dunia nyata, seringkali kita harus bekerja dengan desain database kustom. Contoh kasus tabel bernama ",(0,a.jsx)(n.code,{children:"accounts"})," dan ",(0,a.jsx)(n.code,{children:"roles"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"1\ufe0f\u20e3-mengapa-menggunakan-custom-tables",children:"1\ufe0f\u20e3 Mengapa Menggunakan Custom Tables?"}),"\n",(0,a.jsxs)(n.p,{children:["Secara default, Spring Security mencari tabel bernama ",(0,a.jsx)(n.code,{children:"users"})," dan ",(0,a.jsx)(n.code,{children:"authorities"}),". Namun, kita mungkin ingin menggunakan nama lain, misalnya:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Tabel ",(0,a.jsx)(n.code,{children:"accounts"})," bukan ",(0,a.jsx)(n.code,{children:"users"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["Kolom ",(0,a.jsx)(n.code,{children:"user_id"})," bukan ",(0,a.jsx)(n.code,{children:"username"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["Kolom ",(0,a.jsx)(n.code,{children:"user_password"})," bukan ",(0,a.jsx)(n.code,{children:"password"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["Kolom ",(0,a.jsx)(n.code,{children:"active"})," bukan ",(0,a.jsx)(n.code,{children:"enabled"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["Tabel ",(0,a.jsx)(n.code,{children:"roles"})," bukan ",(0,a.jsx)(n.code,{children:"authorities"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["Kolom ",(0,a.jsx)(n.code,{children:"user_id"})," bukan ",(0,a.jsx)(n.code,{children:"username"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:["Kolom ",(0,a.jsx)(n.code,{children:"user_role"})," bukan ",(0,a.jsx)(n.code,{children:"authority"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"2\ufe0f\u20e3-contoh-skema-database-kustom",children:"2\ufe0f\u20e3 Contoh Skema Database Kustom"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Misalkan kita memiliki tabel SQL sebagai berikut:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE `accounts` (\r\n  `user_id` varchar(50) NOT NULL,\r\n  `user_password` char(68) NOT NULL,\r\n  `active` tinyint NOT NULL,\r\n  PRIMARY KEY (`user_id`)\r\n);\r\n\r\nCREATE TABLE `roles` (\r\n  `user_id` varchar(50) NOT NULL,\r\n  `user_role` varchar(50) NOT NULL,\r\n  UNIQUE KEY `authorities5_idx_1` (`user_id`,`user_role`),\r\n  CONSTRAINT `authorities5_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `accounts` (`user_id`)\r\n);\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Insert data:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"INSERT INTO `accounts` \r\nVALUES \r\n-- Password = test123 --\r\n('aco','$2a$12$J5TR1bl3yRrUJ5LHAezNH.r8Bs9zCOuTsop2PAmUxmUEP7j7V5Mke',1), \r\n('ade','$2a$12$J5TR1bl3yRrUJ5LHAezNH.r8Bs9zCOuTsop2PAmUxmUEP7j7V5Mke',1),\r\n('ucup','$2a$12$J5TR1bl3yRrUJ5LHAezNH.r8Bs9zCOuTsop2PAmUxmUEP7j7V5Mke',1);\r\n\r\nINSERT INTO `roles` \r\nVALUES \r\n('aco','ROLE_GUEST'),\r\n('ade','ROLE_GUEST'),\r\n('ade','ROLE_USERS'),\r\n('ucup','ROLE_GUEST'),\r\n('ucup','ROLE_USERS'),\r\n('ucup','ROLE_ADMIN');\n"})}),"\n",(0,a.jsx)(n.h2,{id:"3\ufe0f\u20e3-konfigurasi-menggunakan-custom-query",children:"3\ufe0f\u20e3 Konfigurasi: Menggunakan Custom Query"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@Configuration\r\npublic class SecurityConfig {\r\n\r\n\t// membuat user konfigurasi dari database\r\n\t@Bean\r\n\tpublic UserDetailsManager userDetailsManager(DataSource dataSource) {\r\n\t\tJdbcUserDetailsManager jdbcUserDetailsManager = new JdbcUserDetailsManager(dataSource);\r\n\t\t\r\n\t\t// set query untuk mendapatkan user berdasarkan username\r\n\t\tjdbcUserDetailsManager.setUsersByUsernameQuery(\r\n\t\t\t\t"SELECT user_id, user_password, active FROM members WHERE user_id=?");\r\n\t\t\r\n\t\t// set query untuk mendapatkan role berdasarkan username\r\n\t\tjdbcUserDetailsManager.setAuthoritiesByUsernameQuery(\r\n\t\t\t\t"SELECT user_id, user_role FROM roles WHERE user_id=?");\r\n\t\t\r\n\t\treturn jdbcUserDetailsManager;\t\t\r\n\t}\r\n\t\r\n\t// Bean untuk Password Encoder BCrypt\r\n\t@Bean\r\n\tpublic PasswordEncoder passwordEncoder() {\r\n\t    // Angka 12 adalah \'High security\' (log rounds) cocok production. Standar adalah 10-12.\r\n\t    return new BCryptPasswordEncoder(12);\r\n\t}\r\n\t\r\n\t// konfig custom login page\r\n\t@Bean\r\n\tpublic SecurityFilterChain filterChain(HttpSecurity httpSecurity) throws Exception {\r\n\t\t\r\n\t\thttpSecurity.authorizeHttpRequests(configurer -> \r\n\t\t\t\t\tconfigurer\r\n\t\t\t\t\t\t.requestMatchers("/").hasRole("GUEST")\r\n\t\t\t\t\t\t.requestMatchers("/user/**").hasAnyRole("USERS", "ADMIN")\r\n\t\t\t\t\t\t.requestMatchers("/admin/**").hasRole("ADMIN")\r\n\t\t\t\t\t\t.anyRequest().authenticated()\r\n\t\t\t\t).formLogin(form ->\r\n\t\t\t\t\tform\r\n\t\t\t\t\t\t.loginPage("/loginPage")\r\n\t\t\t\t\t\t.loginProcessingUrl("/authentication")\r\n\t\t\t\t\t\t.permitAll()\r\n\t\t\t\t).logout(logout -> \r\n\t\t\t\t\tlogout.permitAll()\r\n\t\t\t\t).exceptionHandling(configurer ->\r\n\t\t\t\t\tconfigurer.accessDeniedPage("/access-denied")\r\n\t\t\t\t);\r\n\t\t\r\n\t\treturn httpSecurity.build();\r\n\t}\r\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"4\ufe0f\u20e3-hal-penting-yang-harus-diperhatikan",children:"4\ufe0f\u20e3 Hal Penting yang Harus Diperhatikan"}),"\n",(0,a.jsx)(n.p,{children:"Saat menulis kueri kustom, pastikan urutan kolom yang dipilih sesuai dengan harapan Spring Security:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Users Query"}),": Harus mengembalikan 3 kolom dengan urutan: ",(0,a.jsx)(n.code,{children:"username"}),", ",(0,a.jsx)(n.code,{children:"password"}),", dan ",(0,a.jsx)(n.code,{children:"enabled"})," (boolean/tinyint)."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Authorities Query"}),": Harus mengembalikan 2 kolom dengan urutan: ",(0,a.jsx)(n.code,{children:"username"})," dan ",(0,a.jsx)(n.code,{children:"authority"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Integrasi dengan BCrypt"}),": Meskipun tabelnya kustom, pastikan kolom  ",(0,a.jsx)(n.code,{children:"user_password"})," tetap berisi hash BCrypt"]}),"\n"]}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Source Code"}),": ",(0,a.jsx)(n.a,{href:"https://github.com/TimposuLabs/belajar-springboot-mvc-security/tree/main/12-belajar-springboot-security-jdbc-custom-tables",children:"https://github.com/TimposuLabs/belajar-springboot-mvc-security/tree/main/12-belajar-springboot-security-jdbc-custom-tables"})]})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);