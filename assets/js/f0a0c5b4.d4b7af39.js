"use strict";(globalThis.webpackChunktimposu=globalThis.webpackChunktimposu||[]).push([[5324],{6968(n,e,a){a.r(e),a.d(e,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"docker-image-advance/instruksi-entrypoint","title":"Dockerfile ENTRYPOINT","description":"\ud83e\udd14 Apa itu Instruksi Dockerfile ENTRYPOINT?","source":"@site/tutorial/docker/07-docker-image-advance/09-instruksi-entrypoint.md","sourceDirName":"07-docker-image-advance","slug":"/docker-image-advance/instruksi-entrypoint","permalink":"/docker/docker-image-advance/instruksi-entrypoint","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9,"title":"Dockerfile ENTRYPOINT"},"sidebar":"tutorialSidebar","previous":{"title":"Dockerfile WORKDIR","permalink":"/docker/docker-image-advance/instruksi-workdir"},"next":{"title":"Dockerfile USER","permalink":"/docker/docker-image-advance/instruksi-user"}}');var s=a(74848),r=a(28453);const d={sidebar_position:9,title:"Dockerfile ENTRYPOINT"},t=void 0,l={},c=[{value:"\ud83e\udd14 Apa itu Instruksi Dockerfile <code>ENTRYPOINT</code>?",id:"-apa-itu-instruksi-dockerfile-entrypoint",level:2},{value:"1\ufe0f\u20e3 Perbedaan: <code>ENTRYPOINT</code> vs <code>CMD</code>",id:"1\ufe0f\u20e3-perbedaan-entrypoint-vs-cmd",level:2},{value:"3\ufe0f\u20e3 Mengapa Menggunakan ENTRYPOINT?",id:"3\ufe0f\u20e3-mengapa-menggunakan-entrypoint",level:2},{value:"4\ufe0f\u20e3 Format Penulisan (Wajib Exec Form)",id:"4\ufe0f\u20e3-format-penulisan-wajib-exec-form",level:2},{value:"4\ufe0f\u20e3 Best Practice: Script Pembungkus (Entrypoint Script)",id:"4\ufe0f\u20e3-best-practice-script-pembungkus-entrypoint-script",level:2},{value:"\ud83d\udcbb Skenario Kasus pada Java",id:"-skenario-kasus-pada-java",level:3},{value:"5\ufe0f\u20e3 Cara Memaksa Mengganti <code>ENTRYPOINT</code>",id:"5\ufe0f\u20e3-cara-memaksa-mengganti-entrypoint",level:2},{value:"\ud83d\udd25 Kesimpulan",id:"-kesimpulan",level:2}];function o(n){const e={admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.h2,{id:"-apa-itu-instruksi-dockerfile-entrypoint",children:["\ud83e\udd14 Apa itu Instruksi Dockerfile ",(0,s.jsx)(e.code,{children:"ENTRYPOINT"}),"?"]}),"\n",(0,s.jsxs)(e.p,{children:["Instruksi ",(0,s.jsx)(e.code,{children:"ENTRYPOINT"})," mirip dengan instruksi ",(0,s.jsx)(e.code,{children:"CMD"}),". ",(0,s.jsx)(e.code,{children:"ENTRYPOINT"})," adalah instruksi yang digunakan untuk menetapkan perintah utama yang pasti dijalankan saat kontainer dimulai. Berbeda dengan ",(0,s.jsx)(e.code,{children:"CMD"}),' yang bersifat sebagai "saran default", ',(0,s.jsx)(e.code,{children:"ENTRYPOINT"})," membuat kontainer berperilaku seperti sebuah aplikasi mandiri (executable)."]}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsxs)(e.p,{children:["Secara teknis, hanya satu ",(0,s.jsx)(e.code,{children:"ENTRYPOINT"})," yang berlaku pada satu Dockerfile. Jika butuh lebih dari satu aksi, bungkuslah aksi-aksi tersebut ke dalam sebuah skrip ",(0,s.jsx)(e.em,{children:"shell"})," dan jadikan skrip tersebut sebagai satu-satunya ",(0,s.jsx)(e.code,{children:"ENTRYPOINT"}),"."]})}),"\n",(0,s.jsxs)(e.h2,{id:"1\ufe0f\u20e3-perbedaan-entrypoint-vs-cmd",children:["1\ufe0f\u20e3 Perbedaan: ",(0,s.jsx)(e.code,{children:"ENTRYPOINT"})," vs ",(0,s.jsx)(e.code,{children:"CMD"})]}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"Fitur"}),(0,s.jsx)(e.th,{children:"CMD"}),(0,s.jsx)(e.th,{children:"ENTRYPOINT"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"Sifat"})}),(0,s.jsx)(e.td,{children:"Default (Mudah diganti)."}),(0,s.jsx)(e.td,{children:"Permanen (Sulit diganti)."})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsxs)(e.strong,{children:["Jika diberi argumen saat ",(0,s.jsx)(e.code,{children:"docker run"})]})}),(0,s.jsx)(e.td,{children:"Seluruh perintah diganti."}),(0,s.jsx)(e.td,{children:"Argumen ditempelkan di belakangnya."})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"Tujuan"})}),(0,s.jsx)(e.td,{children:"Memberikan perintah default."}),(0,s.jsx)(e.td,{children:"Menjadikan kontainer sebagai Tool spesifik."})]})]})]}),"\n",(0,s.jsx)(e.h2,{id:"3\ufe0f\u20e3-mengapa-menggunakan-entrypoint",children:"3\ufe0f\u20e3 Mengapa Menggunakan ENTRYPOINT?"}),"\n",(0,s.jsxs)(e.p,{children:["Misalkan kita membuat image untuk melakukan ",(0,s.jsx)(e.em,{children:"ping"}),"."]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.strong,{children:["Jika menggunakan ",(0,s.jsx)(e.code,{children:"CMD"}),":"]})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-dockerfile",children:'CMD ["ping", "google.com"]\n'})}),"\n",(0,s.jsxs)(e.p,{children:["Jika kita menjalankan ",(0,s.jsx)(e.code,{children:"docker run my-ping yahoo.com"}),", maka ",(0,s.jsx)(e.code,{children:"ping google.com"})," ",(0,s.jsx)(e.strong,{children:"hilang"})," dan digantikan oleh ",(0,s.jsx)(e.code,{children:"yahoo.com"})," (yang akan menyebabkan error karena ",(0,s.jsx)(e.code,{children:"yahoo.com"})," bukan sebuah perintah)."]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.strong,{children:["Jika menggunakan ",(0,s.jsx)(e.code,{children:"ENTRYPOINT"}),":"]})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-dockerfile",children:'ENTRYPOINT ["ping"]\nCMD ["google.com"]\n'})}),"\n",(0,s.jsxs)(e.p,{children:["Jika kita menjalankan ",(0,s.jsx)(e.code,{children:"docker run my-ping yahoo.com"}),", maka ",(0,s.jsx)(e.code,{children:"yahoo.com"})," akan mengisi posisi ",(0,s.jsx)(e.code,{children:"CMD"})," dan ditempelkan ke ",(0,s.jsx)(e.code,{children:"ENTRYPOINT"}),". Perintah akhirnya menjadi: ",(0,s.jsx)(e.code,{children:"ping yahoo.com"}),"."]}),"\n",(0,s.jsx)(e.h2,{id:"4\ufe0f\u20e3-format-penulisan-wajib-exec-form",children:"4\ufe0f\u20e3 Format Penulisan (Wajib Exec Form)"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Sangat dilarang"})," menggunakan ",(0,s.jsx)(e.em,{children:"Shell Form"})," untuk ",(0,s.jsx)(e.code,{children:"ENTRYPOINT"})," karena akan membuat aplikasi tidak bisa menerima sinyal mati (",(0,s.jsx)(e.em,{children:"SIGTERM"}),") secara bersih."]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Benar (Exec Form) \u2705"}),": ",(0,s.jsx)(e.code,{children:'ENTRYPOINT ["java", "-jar", "app.jar"]'})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Salah (Shell Form) \u274c"}),": ",(0,s.jsx)(e.code,{children:"ENTRYPOINT java -jar app.jar"})]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"4\ufe0f\u20e3-best-practice-script-pembungkus-entrypoint-script",children:"4\ufe0f\u20e3 Best Practice: Script Pembungkus (Entrypoint Script)"}),"\n",(0,s.jsxs)(e.p,{children:["Seringkali kita perlu melakukan persiapan sebelum aplikasi utama jalan (seperti mengecek koneksi database). Kita bisa menggunakan script ",(0,s.jsx)(e.code,{children:".sh"})," sebagai ",(0,s.jsx)(e.code,{children:"ENTRYPOINT"}),"."]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"entrypoint.sh"})}),":"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sh",children:'#!/bin/sh\necho "Melakukan persiapan sistem..."\n# Menjalankan perintah utama yang dikirim dari CMD\nexec "$@"\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.em,{children:["Catatan: ",(0,s.jsx)(e.code,{children:'exec "$@"'})," adalah perintah yang memastikan aplikasi utama mengambil alih proses kontainer."]})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Dockerfile"}),":"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-dockerfile",children:'COPY entrypoint.sh /entrypoint.sh\nRUN chmod +x /entrypoint.sh\nENTRYPOINT ["/entrypoint.sh"]\nCMD ["java", "-jar", "app.jar"]\n'})}),"\n",(0,s.jsx)(e.h3,{id:"-skenario-kasus-pada-java",children:"\ud83d\udcbb Skenario Kasus pada Java"}),"\n",(0,s.jsx)(e.p,{children:'Aplikasi Java tidak boleh menyala sebelum database (MySQL/PostgreSQL) siap menerima koneksi. Jika Java menyala duluan, aplikasi akan langsung crash. Kita akan menggunakan skrip shell untuk "menunggu" database.'}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.strong,{children:["1. File: ",(0,s.jsx)(e.code,{children:"entrypoint.sh"})]})}),"\n",(0,s.jsx)(e.p,{children:"Skrip ini berfungsi sebagai penjaga gerbang. Ia akan mengecek port database sebelum mengizinkan Java berjalan."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:'#!/bin/sh\n\n# Berhenti jika ada error\nset -e\n\necho "--- Tahap Persiapan Kontainer ---"\n\n# Fungsi untuk menunggu database\n# Menggunakan netcat (nc) untuk mengecek apakah port database sudah terbuka\nuntil nc -z -v -w30 "$DATABASE_ADDR" "$DB_PORT"; do\n  echo "Menunggu Database ($DATABASE_ADDR:$DB_PORT) siap..."\n  sleep 2\ndone\n\necho "Database sudah siap! Memulai aplikasi Java..."\n\n# \'exec "$@"\' sangat penting. \n# Ini memindahkan sinyal sistem (seperti stop/terminate) langsung ke proses Java\nexec "$@"\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsxs)(e.strong,{children:["2. File: ",(0,s.jsx)(e.code,{children:"Dockerfile"})]})}),"\n",(0,s.jsxs)(e.p,{children:["Di sini kita menggabungkan ",(0,s.jsx)(e.code,{children:"ENTRYPOINT"})," (untuk skrip penjaga) dan ",(0,s.jsx)(e.code,{children:"CMD"})," (untuk perintah aplikasi)."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-dockerfile",children:'FROM eclipse-temurin:21-jre-ubi9-minimal\n\nWORKDIR /app\n\n# Instalasi netcat (nc) untuk pengecekan koneksi di UBI9-Minimal\nRUN microdnf install -y nc && microdnf clean all\n\n# Salin file aplikasi dan skrip\nCOPY target/app.jar app.jar\nCOPY entrypoint.sh .\n\n# Berikan izin eksekusi pada skrip\nRUN chmod +x entrypoint.sh\n\n# Environment variable default (bisa ditimpa saat docker run)\nENV DATABASE_ADDR=localhost\nENV DB_PORT=3306\n\n# ENTRYPOINT menjalankan skrip penjaga\nENTRYPOINT ["./entrypoint.sh"]\n\n# CMD memberikan perintah default yang akan dikirim ke \'exec "$@"\' di skrip\nCMD ["java", "-jar", "app.jar"]\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"3. Cara Menjalankannya"})}),"\n",(0,s.jsx)(e.p,{children:"Saat menjalankan kontainer, alurnya akan menjadi seperti ini:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"docker run -d \\\n  --name my-app \\\n  -e DATABASE_ADDR=172.17.0.2 \\\n  -e DB_PORT=3306 \\\n  my-java-image:v1\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\ud83c\udfc3 Apa yang Terjadi di Balik Layar?"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Eksekusi Pertama"}),": Docker menjalankan ",(0,s.jsx)(e.code,{children:"./entrypoint.sh"}),"."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Looping"}),": Skrip menjalankan ",(0,s.jsx)(e.code,{children:"nc"}),' (netcat). Jika database belum siap, ia akan mencetak "Menunggu Database..." dan mengulang setiap 2 detik.']}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Lolos"}),": Begitu database siap, skrip selesai."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Handover"}),": Perintah ",(0,s.jsx)(e.code,{children:'exec "$@"'})," mengambil isi dari ",(0,s.jsx)(e.code,{children:"CMD"})," (yaitu ",(0,s.jsx)(e.code,{children:"java -jar app.jar"}),") dan menjalankannya sebagai ",(0,s.jsx)(e.strong,{children:"proses utama (PID 1"}),")."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Graceful Shutdown"}),": Karena menggunakan ",(0,s.jsx)(e.code,{children:"exec"}),", saat mengetik ",(0,s.jsx)(e.code,{children:"docker stop"}),", aplikasi Java akan menerima sinyal tersebut secara langsung dan bisa menutup koneksi database dengan rapi sebelum mati."]}),"\n"]}),"\n",(0,s.jsxs)(e.h2,{id:"5\ufe0f\u20e3-cara-memaksa-mengganti-entrypoint",children:["5\ufe0f\u20e3 Cara Memaksa Mengganti ",(0,s.jsx)(e.code,{children:"ENTRYPOINT"})]}),"\n",(0,s.jsxs)(e.p,{children:["Meskipun permanen, kita tetap bisa menggantinya dalam kondisi darurat (misal untuk debugging) menggunakan flag ",(0,s.jsx)(e.code,{children:"--entrypoint"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"docker run --rm -it --entrypoint sh nama_image\n"})}),"\n",(0,s.jsx)(e.h2,{id:"-kesimpulan",children:"\ud83d\udd25 Kesimpulan"}),"\n",(0,s.jsxs)(e.p,{children:["Gunakan ",(0,s.jsx)(e.code,{children:"ENTRYPOINT"})," untuk perintah yang tidak boleh diubah (seperti ",(0,s.jsx)(e.code,{children:"java"}),", ",(0,s.jsx)(e.code,{children:"python"}),", atau ",(0,s.jsx)(e.code,{children:"nginx"}),"), dan gunakan ",(0,s.jsx)(e.code,{children:"CMD"})," untuk argumen atau parameter default yang mungkin ingin diubah oleh pengguna saat menjalankan kontainer."]})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(o,{...n})}):o(n)}},28453(n,e,a){a.d(e,{R:()=>d,x:()=>t});var i=a(96540);const s={},r=i.createContext(s);function d(n){const e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:d(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);