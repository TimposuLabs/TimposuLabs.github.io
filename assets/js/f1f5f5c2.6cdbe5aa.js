"use strict";(self.webpackChunktimposu=self.webpackChunktimposu||[]).push([[8615],{36585:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>c,frontMatter:()=>t,metadata:()=>i,toc:()=>u});const i=JSON.parse('{"id":"express/cookie-signed","title":"Signed Cookie","description":"Salah satu kekurangan dalam menyimpan informasi di Cookie adalah bahwa Cookie dapat diubah oleh Klien, contohnya kita dapat mengubah Cookie di Browser yang kita gunakan. Untuk mencegah pemodifikasian Cookie, salah satu metode yang bisa diterapkan adalah dengan menambahkan Tanda Tangan / Signature pada Cookie yang kita miliki. Setiap nilai Cookie akan disertai dengan Signature, di mana jika nilai Cookie tersebut diubah, maka Signature otomatis tidak akan sesuai lagi, dan nilai Cookie tersebut tidak akan dianggap sah. Fitur ini sudah tersedia dalam Cookie Parser yang disebut sebagai Signed Cookie. Kita perlu menentukan Cookie mana yang akan diberi Signature saat membuat Cookie dalam response. Di samping itu, kita juga harus menyertakan Secret Key yang akan digunakan saat proses pembuatan Signature, pastikan Secret Key tersebut aman dan sulit untuk ditebak.","source":"@site/tutorial/nodejs/express/16-cookie-signed.md","sourceDirName":"express","slug":"/express/cookie-signed","permalink":"/nodejs/express/cookie-signed","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":16,"frontMatter":{"sidebar_position":16,"title":"Signed Cookie"},"sidebar":"tutorialSidebar","previous":{"title":"Cookie","permalink":"/nodejs/express/cookie"},"next":{"title":"Response Body","permalink":"/nodejs/express/response-body"}}');var s=a(74848),o=a(28453);const t={sidebar_position:16,title:"Signed Cookie"},r=void 0,d={},u=[{value:"\u270d\ufe0f Membuat Signed Cookie",id:"\ufe0f-membuat-signed-cookie",level:2},{value:"\ud83d\udcd6 Membaca Signed Cookie",id:"-membaca-signed-cookie",level:2},{value:"\u270a Full Code dengan Unit Test",id:"-full-code-dengan-unit-test",level:2}];function k(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Salah satu kekurangan dalam menyimpan informasi di Cookie adalah bahwa Cookie dapat diubah oleh Klien, contohnya kita dapat mengubah Cookie di Browser yang kita gunakan. Untuk mencegah pemodifikasian Cookie, salah satu metode yang bisa diterapkan adalah dengan menambahkan Tanda Tangan / Signature pada Cookie yang kita miliki. Setiap nilai Cookie akan disertai dengan Signature, di mana jika nilai Cookie tersebut diubah, maka Signature otomatis tidak akan sesuai lagi, dan nilai Cookie tersebut tidak akan dianggap sah. Fitur ini sudah tersedia dalam Cookie Parser yang disebut sebagai Signed Cookie. Kita perlu menentukan Cookie mana yang akan diberi Signature saat membuat Cookie dalam response. Di samping itu, kita juga harus menyertakan ",(0,s.jsx)(n.strong,{children:"Secret Key"})," yang akan digunakan saat proses pembuatan Signature, pastikan Secret Key tersebut aman dan sulit untuk ditebak."]}),"\n",(0,s.jsx)(n.h2,{id:"\ufe0f-membuat-signed-cookie",children:"\u270d\ufe0f Membuat Signed Cookie"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const express = require('express');\nconst cookieParser = require('cookie-parser');\n\nconst app = express();\napp.use(express.json());\napp.use(cookieParser('secret1234567890')); // menambahkan middleware cookie-parser dengan secret untuk signed cookie\n\n// Endpoint membuat cookie ke client\napp.post('/login', (req, res) => {\n    const username = req.body.username;\n    res.cookie(\"Username\", username, {path: '/', signed: true}); // set signed true agar cookie ditandatangani\n    res.send(`Hello ${username}, kamu sudah login.`);\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"Contoh Signed Cookie yang dihasilkan:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Username=s%3AUcup.9HsB3mkjxHhOsL7tIBNSbu%2BNdXH0CYUmnXw0zR%2Fu0xo\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-membaca-signed-cookie",children:"\ud83d\udcd6 Membaca Signed Cookie"}),"\n",(0,s.jsxs)(n.p,{children:["Jika kita membuat Cookie dalam bentuk Signed Cookie, maka untuk mengaksesnya, jangan memakai ",(0,s.jsx)(n.code,{children:"req.cookies()"})," \u274c, tetapi harus menggunakan ",(0,s.jsx)(n.code,{children:"req.signedCookies()"})," \u2705."]}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://expressjs.com/en/5x/api.html#req.signedCookies",children:"https://expressjs.com/en/5x/api.html#req.signedCookies"})}),"\n"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const express = require('express');\nconst cookieParser = require('cookie-parser');\n\nconst app = express();\napp.use(express.json());\napp.use(cookieParser('secret1234567890')); // menambahkan middleware cookie-parser dengan secret untuk signed cookie\n\n// Endpoint membaca cookie yang dikirimkan oleh client\napp.get('/', (req, res) => {\n    const username = req.signedCookies[\"Username\"];\n    res.send(`Hello ${username}!`);\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-full-code-dengan-unit-test",children:"\u270a Full Code dengan Unit Test"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const request = require('supertest');\nconst express = require('express');\nconst cookieParser = require('cookie-parser');\n\nconst app = express();\napp.use(express.json());\napp.use(cookieParser('secret1234567890')); // menambahkan middleware cookie-parser dengan secret untuk signed cookie\n\n// Endpoint membaca cookie yang dikirimkan oleh client\napp.get('/', (req, res) => {\n    const username = req.signedCookies[\"Username\"];\n    res.send(`Hello ${username}!`);\n});\n\n// Endpoint mengirim cookie ke client\napp.post('/login', (req, res) => {\n    const username = req.body.username;\n    res.cookie(\"Username\", username, {path: '/', signed: true}); // set signed true agar cookie ditandatangani\n    res.send(`Hello ${username}, kamu sudah login.`);\n});\n\n// Unit Test\ntest('Test Membaca(Read) Cookie / endpoint', async () => {\n    const response = await request(app).get('/')\n    .set('Cookie', ['Username=s%3AUcup.9HsB3mkjxHhOsL7tIBNSbu%2BNdXH0CYUmnXw0zR%2Fu0xo; Path=/']); // cookie signed diambil dari hasil response sebelumnya console.info(response.get('set-cookie'));\n    \n    expect(response.status).toBe(200);\n    expect(response.text).toBe('Hello Ucup!');\n});\n\ntest('Test Membuat(Write) Cookie /login endpoint', async () => {\n    const response = await request(app).post('/login')\n    .send({username: 'Ucup'});\n    console.info(response.get('set-cookie')); // log untuk melihat nilai cookie yang dihasilkan OUTPUT: 'Username=s%3AUcup.9HsB3mkjxHhOsL7tIBNSbu%2BNdXH0CYUmnXw0zR%2Fu0xo; Path=/']\n\n    expect(response.status).toBe(200);\n    expect(response.get('set-cookie').toString()).toContain('Ucup'); // memastikan cookie terkirim dengan benar, menggunakan toContain() karena cookie signed akan memiliki nilai yang berbeda setiap kali dibuat\n    expect(response.text).toBe('Hello Ucup, kamu sudah login.');\n});\n"})})]})}function c(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(k,{...e})}):k(e)}},28453:(e,n,a)=>{a.d(n,{R:()=>t,x:()=>r});var i=a(96540);const s={},o=i.createContext(s);function t(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);