"use strict";(self.webpackChunktimposu=self.webpackChunktimposu||[]).push([[50453],{94083:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"docker-container-advance/self-healing","title":"Docker Self-Healing","description":"\ud83e\udd14 Apa itu Self-Healing?","source":"@site/tutorial/docker/08-docker-container-advance/03-self-healing.md","sourceDirName":"08-docker-container-advance","slug":"/docker-container-advance/self-healing","permalink":"/docker/docker-container-advance/self-healing","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Docker Self-Healing"},"sidebar":"tutorialSidebar","previous":{"title":"Konfigurasi Container secara Imperatif","permalink":"/docker/docker-container-advance/config-contianer-imperatif"},"next":{"title":"Membuat Image dari Container","permalink":"/docker/docker-container-advance/membuat-image-dari-container"}}');var t=n(74848),r=n(28453);const s={sidebar_position:3,title:"Docker Self-Healing"},l=void 0,c={},d=[{value:"\ud83e\udd14 Apa itu Self-Healing?",id:"-apa-itu-self-healing",level:2},{value:"1\ufe0f\u20e3 Restart Policies",id:"1\ufe0f\u20e3-restart-policies",level:2},{value:"A. Jenis-Jenis Restart Policy:",id:"a-jenis-jenis-restart-policy",level:3},{value:"B. Contoh Penggunaan Imperatif",id:"b-contoh-penggunaan-imperatif",level:3},{value:"2\ufe0f\u20e3 Healthcheck (Pengecekan Kesehatan)",id:"2\ufe0f\u20e3-healthcheck-pengecekan-kesehatan",level:2},{value:"Cara Kerja Healthcheck:",id:"cara-kerja-healthcheck",level:3},{value:"Implementasi dalam Dockerfile",id:"implementasi-dalam-dockerfile",level:3}];function o(e){const a={admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.h2,{id:"-apa-itu-self-healing",children:"\ud83e\udd14 Apa itu Self-Healing?"}),"\n",(0,t.jsxs)(a.p,{children:[(0,t.jsx)(a.strong,{children:"Self-healing"})," adalah kemampuan sistem untuk mendeteksi kegagalan (aplikasi mati, error, atau server restart) dan melakukan tindakan perbaikan secara otomatis (menjalankan ulang kontainer) tanpa menunggu perintah dari user."]}),"\n",(0,t.jsxs)(a.p,{children:["Di Docker, kita menerapkan ini menggunakan dua fitur utama: ",(0,t.jsx)(a.strong,{children:"Restart Policies"})," dan ",(0,t.jsx)(a.strong,{children:"Healthchecks"}),"."]}),"\n",(0,t.jsx)(a.h2,{id:"1\ufe0f\u20e3-restart-policies",children:"1\ufe0f\u20e3 Restart Policies"}),"\n",(0,t.jsxs)(a.p,{children:["Ini adalah instruksi yang memberi tahu Docker Engine apa yang harus dilakukan jika sebuah kontainer berhenti (",(0,t.jsx)(a.em,{children:"Exit"}),")."]}),"\n",(0,t.jsx)(a.h3,{id:"a-jenis-jenis-restart-policy",children:"A. Jenis-Jenis Restart Policy:"}),"\n",(0,t.jsxs)(a.table,{children:[(0,t.jsx)(a.thead,{children:(0,t.jsxs)(a.tr,{children:[(0,t.jsx)(a.th,{children:"Flag"}),(0,t.jsx)(a.th,{children:"Deskripsi"})]})}),(0,t.jsxs)(a.tbody,{children:[(0,t.jsxs)(a.tr,{children:[(0,t.jsx)(a.td,{children:(0,t.jsxs)(a.strong,{children:[(0,t.jsx)(a.code,{children:"no"})," (Default)"]})}),(0,t.jsx)(a.td,{children:"Docker tidak akan menjalankan ulang kontainer jika mati (default)."})]}),(0,t.jsxs)(a.tr,{children:[(0,t.jsx)(a.td,{children:(0,t.jsx)(a.strong,{children:(0,t.jsx)(a.code,{children:"on-failure[:max-retries]"})})}),(0,t.jsxs)(a.td,{children:["Docker akan restart kontainer ",(0,t.jsx)(a.strong,{children:"hanya jika"})," ia mati karena error (Exit Code bukan 0). Kita bisa membatasi berapa kali percobaan (misal: 5 kali)."]})]}),(0,t.jsxs)(a.tr,{children:[(0,t.jsx)(a.td,{children:(0,t.jsx)(a.strong,{children:(0,t.jsx)(a.code,{children:"always"})})}),(0,t.jsx)(a.td,{children:"Docker akan selalu menjalankan ulang kontainer tidak peduli apa penyebab matinya. Jika Docker Engine/Laptop di-restart, kontainer ini akan langsung menyala otomatis saat startup."})]}),(0,t.jsxs)(a.tr,{children:[(0,t.jsx)(a.td,{children:(0,t.jsx)(a.strong,{children:(0,t.jsx)(a.code,{children:"unless-stopped"})})}),(0,t.jsxs)(a.td,{children:["Mirip dengan ",(0,t.jsx)(a.code,{children:"always"}),", namun jika kita menghentikan kontainer secara manual (",(0,t.jsx)(a.code,{children:"docker stop"}),"), Docker tidak akan menyalakannya kembali saat server restart."]})]})]})]}),"\n",(0,t.jsx)(a.admonition,{type:"info",children:(0,t.jsx)(a.p,{children:"Restart Policy hanya berpengaruh jika container berhasil berjalan setidaknya 10 detik.\nJika container mati secara manual, maka restart policy akan diabaikan sampai docker daemon mengalami restart atau container secara manual direstart."})}),"\n",(0,t.jsx)(a.h3,{id:"b-contoh-penggunaan-imperatif",children:"B. Contoh Penggunaan Imperatif"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:["Contoh membuat docker container dengan restart policy ",(0,t.jsx)(a.code,{children:"always"}),":"]}),"\n"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"docker run -d --name web-tahan-banting --restart always nginx\n"})}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsx)(a.li,{children:"Cek status di tab terminal baru:"}),"\n"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"$ docker container ps\n\n CREATED          STATUS          PORTS     NAMES\n13 seconds ago   Up 13 seconds   80/tcp    nginx\n"})}),"\n",(0,t.jsx)(a.p,{children:"Container sudah berjalan lebih dari 10 detik yaitu 13 detik."}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsx)(a.li,{children:'Kemudian matikan container dengan menekan "Ctrl + C", kemudian kita cek lagi status containernya:'}),"\n"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"$ docker container ps\n\n CREATED          STATUS         PORTS     NAMES\n28 seconds ago   Up 3 seconds   80/tcp    nginx\n"})}),"\n",(0,t.jsx)(a.p,{children:"Maka container akan running otomatis dan sudah berjalan selama 3 detik."}),"\n",(0,t.jsx)(a.p,{children:"Untuk membuktikan kita dapat melihat lognya:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"$ docker container logs nginx \n\n...\n2025/03/30 05:50:47 [notice] 1#1: worker process 30 exited with code 0\n2025/03/30 05:50:47 [notice] 1#1: exit\n/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration\n...\n"})}),"\n",(0,t.jsx)(a.p,{children:"Container sempat mengalami exit status 0."}),"\n",(0,t.jsx)(a.p,{children:"Jika kita melakukan stop container secara manual, kemudian kita melakukan restart daemon / service docker maka container akan berjalan kembali setelah docker service berjalan."}),"\n",(0,t.jsx)(a.h2,{id:"2\ufe0f\u20e3-healthcheck-pengecekan-kesehatan",children:"2\ufe0f\u20e3 Healthcheck (Pengecekan Kesehatan)"}),"\n",(0,t.jsxs)(a.p,{children:['Restart Policy hanya tahu jika proses aplikasi mati. Namun, terkadang aplikasi masih "hidup" (kontainer statusnya Running) tapi "hang" atau tidak bisa merespon (misal: ',(0,t.jsx)(a.em,{children:"Java Deadlock"}),"). Di sinilah ",(0,t.jsx)(a.strong,{children:"Healthcheck"})," berperan."]}),"\n",(0,t.jsx)(a.p,{children:"Healthcheck memungkinkan Docker mengintip ke dalam kontainer untuk memastikan aplikasi benar-benar berfungsi."}),"\n",(0,t.jsx)(a.h3,{id:"cara-kerja-healthcheck",children:"Cara Kerja Healthcheck:"}),"\n",(0,t.jsxs)(a.ol,{children:["\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Starting"}),": Kontainer baru menyala."]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Healthy"}),": Pengecekan berhasil (aplikasi merespon)."]}),"\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Unhealthy"}),": Pengecekan gagal berturut-turut. Docker akan menandai kontainer ini sebagai rusak."]}),"\n"]}),"\n",(0,t.jsx)(a.h3,{id:"implementasi-dalam-dockerfile",children:"Implementasi dalam Dockerfile"}),"\n",(0,t.jsx)(a.p,{children:"Kita bisa mendefinisikan cara pengecekan langsung di dalam Dockerfile:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-dockerfile",children:'FROM eclipse-temurin:21-jre-alpine\nCOPY target/app.jar app.jar\n\n# Setiap 30 detik, cek apakah port 8080 merespon. \n# Jika gagal 3 kali, tandai sebagai Unhealthy.\nHEALTHCHECK --interval=30s --timeout=3s --retries=3 \\\n  CMD curl -f http://localhost:8080/actuator/health || exit 1\n\nENTRYPOINT ["java", "-jar", "app.jar"]\n'})}),"\n",(0,t.jsxs)(a.admonition,{type:"tip",children:[(0,t.jsxs)(a.p,{children:["Gunakan ",(0,t.jsx)(a.code,{children:"docker ps"}),", kita akan melihat status tambahannya:"]}),(0,t.jsx)(a.p,{children:(0,t.jsx)(a.code,{children:"Up 5 minutes (healthy) atau Up 5 minutes (unhealthy)"})})]})]})}function h(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},28453:(e,a,n)=>{n.d(a,{R:()=>s,x:()=>l});var i=n(96540);const t={},r=i.createContext(t);function s(e){const a=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function l(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(r.Provider,{value:a},e.children)}}}]);