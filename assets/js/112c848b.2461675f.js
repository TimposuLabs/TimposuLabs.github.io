"use strict";(self.webpackChunktimposu=self.webpackChunktimposu||[]).push([[52186],{34241:(a,e,n)=>{n.r(e),n.d(e,{assets:()=>t,contentTitle:()=>d,default:()=>o,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"docker-image-advance/layered","title":"Multiple Layered","description":"docker layered multiple","source":"@site/tutorial/docker/07-docker-image-advance/13-layered.md","sourceDirName":"07-docker-image-advance","slug":"/docker-image-advance/layered","permalink":"/docker/docker-image-advance/layered","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_position":13,"title":"Multiple Layered"},"sidebar":"tutorialSidebar","previous":{"title":"Multi-Stage Build","permalink":"/docker/docker-image-advance/multistage-build"},"next":{"title":"Docker Container - Advance","permalink":"/docker/docker-container-advance/"}}');var r=n(74848),s=n(28453);const l={sidebar_position:13,title:"Multiple Layered"},d=void 0,t={},c=[{value:"\ud83e\udd14 Apa itu Multiple Layered Build?",id:"-apa-itu-multiple-layered-build",level:2},{value:"1\ufe0f\u20e3 Konsep Dasar &quot;Layering&quot;",id:"1\ufe0f\u20e3-konsep-dasar-layering",level:2},{value:"2\ufe0f\u20e3 Cara Kerja Layered Build",id:"2\ufe0f\u20e3-cara-kerja-layered-build",level:2},{value:"3\ufe0f\u20e3 Struktur Dockerfile",id:"3\ufe0f\u20e3-struktur-dockerfile",level:2},{value:"4\ufe0f\u20e3 Keuntungan Utama",id:"4\ufe0f\u20e3-keuntungan-utama",level:2},{value:"5\ufe0f\u20e3 Perbedaan Multi-Stage vs Layered Build",id:"5\ufe0f\u20e3-perbedaan-multi-stage-vs-layered-build",level:2},{value:"6\ufe0f\u20e3 Layered JAR",id:"6\ufe0f\u20e3-layered-jar",level:2},{value:"\u2615 Kenapa di Java (Spring Boot) sedikit Berbeda?",id:"-kenapa-di-java-spring-boot-sedikit-berbeda",level:3},{value:"\ud83d\udc4e Masalah pada JAR Tradisional",id:"-masalah-pada-jar-tradisional",level:3},{value:"\ud83d\udc4d Solusi: Layered JAR",id:"-solusi-layered-jar",level:3},{value:"\ud83d\udd25 Implementasi",id:"-implementasi",level:3}];function u(a){const e={code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...a.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://media.licdn.com/dms/image/v2/D4D12AQGPw6lFQ4pW1A/article-inline_image-shrink_400_744/article-inline_image-shrink_400_744/0/1694168127607?e=2147483647&v=beta&t=kRpfdPI_4aOX79a9Gmoo7Qf4LW2Rt1jFQJeYyTREX3w",alt:"docker layered multiple"})}),"\n",(0,r.jsx)(e.h2,{id:"-apa-itu-multiple-layered-build",children:"\ud83e\udd14 Apa itu Multiple Layered Build?"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Multiple Layered Build"})," adalah teknik membagi sebuah aplikasi menjadi beberapa bagian (lapisan) berdasarkan frekuensi perubahannya."]}),"\n",(0,r.jsx)(e.p,{children:"Tujuannya adalah agar Docker tidak perlu memproses ulang bagian yang besar jika hanya bagian kecil dari aplikasi yang berubah."}),"\n",(0,r.jsx)(e.h2,{id:"1\ufe0f\u20e3-konsep-dasar-layering",children:'1\ufe0f\u20e3 Konsep Dasar "Layering"'}),"\n",(0,r.jsx)(e.p,{children:"Bayangkan aplikasi adalah sebuah paket kiriman. Di dalam paket tersebut terdapat:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Buku Manual (Library/Dependencies)"}),": Sangat berat, tapi isinya jarang sekali berubah."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Surat (Kode Aplikasi)"}),": Sangat ringan, tapi isinya berubah setiap hari."]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["Jika kita mengirim paket ini berkali-kali tanpa teknik layering, kita harus membungkus ulang dan mengirim seluruh berat buku manual tersebut setiap kali suratnya berubah. Dengan ",(0,r.jsx)(e.strong,{children:"Layered Build"}),", kita memisahkan buku manual ke dalam kotak tersendiri yang sudah ada di tujuan, sehingga kita cukup mengirim suratnya saja."]}),"\n",(0,r.jsx)(e.h2,{id:"2\ufe0f\u20e3-cara-kerja-layered-build",children:"2\ufe0f\u20e3 Cara Kerja Layered Build"}),"\n",(0,r.jsxs)(e.p,{children:["Dalam Docker, setiap perintah ",(0,r.jsx)(e.code,{children:"COPY"})," atau ",(0,r.jsx)(e.code,{children:"RUN"})," membuat sebuah Layer. Docker menggunakan sistem ",(0,r.jsx)(e.em,{children:"caching"}),": jika isi sebuah layer tidak berubah, Docker akan menggunakan versi lama yang sudah ada."]}),"\n",(0,r.jsx)(e.p,{children:"Strategi Layered Build membagi struktur file menjadi:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layer Dependensi (Paling Bawah)"}),": Berisi semua pustaka pendukung (misal: folder ",(0,r.jsx)(e.code,{children:"node_modules"})," atau library ",(0,r.jsx)(e.code,{children:".jar"}),"). Ini adalah bagian paling besar."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layer Konfigurasi"}),": Berisi file pengaturan sistem atau lingkungan(environment)."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layer Aplikasi (Paling Atas)"}),": Berisi kode sumber (source code) yang kita tulis. Ini adalah bagian yang paling sering berubah."]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"3\ufe0f\u20e3-struktur-dockerfile",children:"3\ufe0f\u20e3 Struktur Dockerfile"}),"\n",(0,r.jsx)(e.p,{children:"Berikut adalah pola umum yang diterapkan pada hampir semua bahasa pemrograman (Node.js, Python, Go, Java):"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-dockerfile",children:"# 1. Install Dependensi (Hanya dilakukan jika file definisi package berubah)\nCOPY package-definition.file . \nRUN install-dependencies-command \n\n# 2. Copy Source Code (Dilakukan setiap kali ada perubahan kode)\nCOPY ./src ./src\n\n# 3. Build/Run\nRUN build-command\n"})}),"\n",(0,r.jsx)(e.h2,{id:"4\ufe0f\u20e3-keuntungan-utama",children:"4\ufe0f\u20e3 Keuntungan Utama"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Penyimpanan Pintar"}),": Jika kita memiliki 10 aplikasi berbeda yang menggunakan library yang sama, Docker hanya perlu menyimpan satu salinan library tersebut di server."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Deployment Super Cepat"}),': Saat kita melakukan update aplikasi, proses "upload" ke server hanya memakan waktu beberapa detik karena Docker hanya mengirim potongan kode yang berubah.']}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Efisiensi Sumber Daya"}),": Mengurangi beban kerja pada sistem CI/CD (",(0,r.jsx)(e.em,{children:"Continuous Integration"}),") dan menghemat kuota internet/bandwidth."]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"5\ufe0f\u20e3-perbedaan-multi-stage-vs-layered-build",children:"5\ufe0f\u20e3 Perbedaan Multi-Stage vs Layered Build"}),"\n",(0,r.jsx)(e.p,{children:"Seringkali orang bingung antara keduanya, padahal mereka bekerja sama:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Multi-Stage Build"}),": Fokus pada ",(0,r.jsx)(e.strong,{children:"hasil akhir"})," (membuang sampah kompilasi agar image kecil). Ibarat membuang bungkus makanan setelah selesai dimasak."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layered Build"}),": Fokus pada ",(0,r.jsx)(e.strong,{children:"proses pembuatan"})," (menyusun urutan agar build cepat). Ibarat memasak bahan yang paling lama matang terlebih dahulu."]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Kesimpulan"}),":"]}),"\n",(0,r.jsxs)(e.p,{children:["Gunakan ",(0,r.jsx)(e.strong,{children:"Multi-Stage"})," untuk mendapatkan image yang ",(0,r.jsx)(e.strong,{children:"ringan"}),", dan gunakan ",(0,r.jsx)(e.strong,{children:"Layered Build"})," agar proses update image tersebut cepat."]}),"\n",(0,r.jsx)(e.h2,{id:"6\ufe0f\u20e3-layered-jar",children:"6\ufe0f\u20e3 Layered JAR"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Layered JAR"})," adalah teknik optimasi khusus Java (terutama Spring Boot) yang lebih daripada sekadar ",(0,r.jsx)(e.em,{children:"multi-stage build"})," biasa."]}),"\n",(0,r.jsx)(e.p,{children:"Berikut adalah bagaimana bahasa lain menerapkan konsep yang sama (Layering):"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"1. Node.js (JavaScript/TypeScript)"})}),"\n",(0,r.jsxs)(e.p,{children:["Di Node.js, pemisahan dilakukan antara ",(0,r.jsx)(e.code,{children:"node_modules"})," (library) dan kode sumber (",(0,r.jsx)(e.code,{children:"src"}),")."]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layer 1"}),": ",(0,r.jsx)(e.code,{children:"package.json"})," dan ",(0,r.jsx)(e.code,{children:"package-lock.json"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layer 2"}),": ",(0,r.jsx)(e.code,{children:"npm install"})," (Ini adalah bagian terberat yang di-cache)."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layer 3"}),": Kode aplikasi."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Hasil"}),": Jika kita hanya mengubah kode, Docker tidak akan menjalankan ",(0,r.jsx)(e.code,{children:"npm install"})," ulang."]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"2. Python"})}),"\n",(0,r.jsx)(e.p,{children:"Sama seperti Node.js, Python memisahkan instalasi pip dari kode."}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layer 1"}),": ",(0,r.jsx)(e.code,{children:"requirements.txt"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layer 2"}),": ",(0,r.jsx)(e.code,{children:"pip install -r requirements.txt"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layer 3"}),": File ",(0,r.jsx)(e.code,{children:".py"}),"."]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"3. Go (Golang)"})}),"\n",(0,r.jsxs)(e.p,{children:["Go menggunakan fitur ",(0,r.jsx)(e.code,{children:"go mod"})," untuk mengunci dependensi."]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layer 1"}),": ",(0,r.jsx)(e.code,{children:"go.mod"})," dan ",(0,r.jsx)(e.code,{children:"go.sum"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layer 2"}),": ",(0,r.jsx)(e.code,{children:"go mod download"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layer 3"}),": Kompilasi kode sumber."]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"-kenapa-di-java-spring-boot-sedikit-berbeda",children:"\u2615 Kenapa di Java (Spring Boot) sedikit Berbeda?"}),"\n",(0,r.jsxs)(e.p,{children:["Alasannya adalah ",(0,r.jsx)(e.strong,{children:"struktur file-nya"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Bahasa seperti Python atau Node.js menyimpan library di folder terpisah (",(0,r.jsx)(e.code,{children:"node_modules"})," atau ",(0,r.jsx)(e.code,{children:"site-packages"}),") secara alami."]}),"\n",(0,r.jsxs)(e.li,{children:["Java (secara tradisional) membungkus kode dan library menjadi ",(0,r.jsx)(e.strong,{children:"satu file tunggal"})," (",(0,r.jsx)(e.code,{children:".jar"}),'). Tanpa fitur "Layered JAR", Docker terpaksa menganggap satu file itu sebagai satu kesatuan. Jika satu karakter berubah, seluruh file dianggap berubah.']}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"-masalah-pada-jar-tradisional",children:"\ud83d\udc4e Masalah pada JAR Tradisional"}),"\n",(0,r.jsx)(e.p,{children:'Biasanya, Spring Boot menghasilkan "Fat JAR" di mana library pihak ketiga (seperti Hibernate, Spring Cloud, dll) dan kode buatan kita digabung jadi satu.'}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Jika ukuran JAR 100MB (95MB library + 5MB kode kita)."}),"\n",(0,r.jsxs)(e.li,{children:["Setiap kali kita mengubah kode, Docker harus menyalin ulang ",(0,r.jsx)(e.strong,{children:"seluruh 100MB"})," ke dalam layer baru. Ini memboroskan waktu dan penyimpanan."]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"-solusi-layered-jar",children:"\ud83d\udc4d Solusi: Layered JAR"}),"\n",(0,r.jsx)(e.p,{children:"Dengan Layered JAR, isi JAR dipisahkan menjadi 4 kategori standar:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Spring Boot Loader"}),": File internal Spring untuk menjalankan JAR."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Dependencies"}),": Library dari pihak ketiga (jarang berubah)."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Snapshot Dependencies"}),": Library versi pengembangan."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Application"}),": Kode sumber dan file konfigurasi (paling sering berubah)."]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://camo.githubusercontent.com/ca6cb13a9b5c54fc6089976cb4cf3cb1db22e61e4cdb86cd062f01bb87ff8241/68747470733a2f2f7777772e6261656c64756e672e636f6d2f77702d636f6e74656e742f75706c6f6164732f323032302f31312f737072696e672d626f6f742d6c61796572732e6a7067",alt:"Layered JAR"})}),"\n",(0,r.jsx)(e.h3,{id:"-implementasi",children:"\ud83d\udd25 Implementasi"}),"\n",(0,r.jsx)(e.p,{children:"Berikut adalah contoh praktis menggunakan Spring Boot Layered JAR dengan Multi-Stage:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-dockerfile",children:'# STAGE 1: Ekstraksi (Extract)\nFROM eclipse-temurin:25-jdk-alpine-3.23 AS builder\nWORKDIR /app\nCOPY .mvn/ .mvn\nCOPY mvnw .\nCOPY pom.xml .\n\nRUN chmod +x ./mvnw && ./mvnw dependency:go-offline\nCOPY ./src ./src\n# Memecah JAR menjadi layer menggunakan mode jarmode\nRUN ./mvnw clean install && java -Djarmode=layertools -jar target/*.jar extract\n\n# STAGE 2: Membangun Image Final\nFROM eclipse-temurin:25-jre-alpine-3.23\nARG JAR_FILE=target/*.jar\nWORKDIR /app\n\n# Layer ini jarang berubah, Docker akan mengambil dari Cache\nCOPY --from=builder /app/dependencies/ ./\nCOPY --from=builder /app/spring-boot-loader/ ./\nCOPY --from=builder /app/snapshot-dependencies/ ./\n# Layer ini yang paling sering berubah\nCOPY --from=builder /app/application/ ./\n\nRUN adduser -D ucup\nUSER ucup\nENTRYPOINT ["java", "org.springframework.boot.loader.launch.JarLauncher"]\n'})})]})}function o(a={}){const{wrapper:e}={...(0,s.R)(),...a.components};return e?(0,r.jsx)(e,{...a,children:(0,r.jsx)(u,{...a})}):u(a)}},28453:(a,e,n)=>{n.d(e,{R:()=>l,x:()=>d});var i=n(96540);const r={},s=i.createContext(r);function l(a){const e=i.useContext(s);return i.useMemo((function(){return"function"==typeof a?a(e):{...e,...a}}),[e,a])}function d(a){let e;return e=a.disableParentContext?"function"==typeof a.components?a.components(r):a.components||r:l(a.components),i.createElement(s.Provider,{value:e},a.children)}}}]);