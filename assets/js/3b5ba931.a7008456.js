"use strict";(self.webpackChunktimposu=self.webpackChunktimposu||[]).push([[3359],{55850:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>c,frontMatter:()=>d,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"express/middleware","title":"Middleware","description":"Middleware adalah function yang bisa digunakan untuk mengakses request object, response object dan next function dalam siklus aplikasi Express.js. Jika Middleware memanggil next function, artinya akan dilanjutkan ke function Middleware selanjutnya atau Router akan dieksekusi.","source":"@site/tutorial/nodejs/express/09-middleware.md","sourceDirName":"express","slug":"/express/middleware","permalink":"/nodejs/express/middleware","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9,"title":"Middleware"},"sidebar":"tutorialSidebar","previous":{"title":"Redirect","permalink":"/nodejs/express/redirect"},"next":{"title":"Route Path","permalink":"/nodejs/express/route-path"}}');var i=a(74848),s=a(28453);const d={sidebar_position:9,title:"Middleware"},l=void 0,t={},u=[{value:"\ud83d\udcda Middleware Stack",id:"-middleware-stack",level:2},{value:"\u270d\ufe0f Fungsi Middleware",id:"\ufe0f-fungsi-middleware",level:2},{value:"\ud83d\udca1 Penggunaan Umum Middleware",id:"-penggunaan-umum-middleware",level:2},{value:"\ud83d\udcca Ilustrasi Siklus Request dan Middleware",id:"-ilustrasi-siklus-request-dan-middleware",level:2},{value:"\u261d\ufe0f Penjelasan Siklus Middleware (Alur Request)",id:"\ufe0f-penjelasan-siklus-middleware-alur-request",level:3},{value:"\u2699\ufe0f Function Middleware",id:"\ufe0f-function-middleware",level:2},{value:"\ud83e\udde9 Jenis-Jenis Middleware",id:"-jenis-jenis-middleware",level:2},{value:"1\ufe0f\u20e3 Middleware Tingkat Aplikasi (Application-level Middleware)",id:"1\ufe0f\u20e3-middleware-tingkat-aplikasi-application-level-middleware",level:3},{value:"2\ufe0f\u20e3 Middleware Tingkat Router (Router-level Middleware)",id:"2\ufe0f\u20e3-middleware-tingkat-router-router-level-middleware",level:3},{value:"3\ufe0f\u20e3 Middleware untuk Penanganan Error (Error-handling Middleware)",id:"3\ufe0f\u20e3-middleware-untuk-penanganan-error-error-handling-middleware",level:3},{value:"4\ufe0f\u20e3 Built-in Middleware",id:"4\ufe0f\u20e3-built-in-middleware",level:3},{value:"5\ufe0f\u20e3 Third-party Middleware",id:"5\ufe0f\u20e3-third-party-middleware",level:3},{value:"\ud83d\udca1 Contoh Penggunaan",id:"-contoh-penggunaan",level:2},{value:"\ud83d\udd10 Menambahkan Middleware Query Api Key",id:"-menambahkan-middleware-query-api-key",level:3},{value:"\ud83d\udcdd Manipulasi Request",id:"-manipulasi-request",level:3},{value:"\ud83d\udd25 Fullcode dengan Unit Test",id:"-fullcode-dengan-unit-test",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Middleware adalah function yang bisa digunakan untuk mengakses ",(0,i.jsx)(n.code,{children:"request object"}),", ",(0,i.jsx)(n.code,{children:"response object"})," dan ",(0,i.jsx)(n.code,{children:"next function"})," dalam siklus aplikasi Express.js. Jika Middleware memanggil ",(0,i.jsx)(n.code,{children:"next"})," function, artinya akan dilanjutkan ke function Middleware selanjutnya atau Router akan dieksekusi."]}),"\n",(0,i.jsx)(n.h2,{id:"-middleware-stack",children:"\ud83d\udcda Middleware Stack"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Middleware Stack",src:a(92837).A+"",width:"953",height:"256"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.em,{children:["Source: ",(0,i.jsx)(n.a,{href:"https://developer.okta.com/blog/2018/09/13/build-and-understand-express-middleware-through-examples",children:"developer.okta.com"})]})}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-fungsi-middleware",children:"\u270d\ufe0f Fungsi Middleware"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Eksekusi kode sebelum sebelum router di eksekusi (misalnya, logging, autentikasi)."}),"\n",(0,i.jsxs)(n.li,{children:["Mengubah Request atau Response object sebelum router di eksekusi (misalnya, menambahkan properti ke ",(0,i.jsx)(n.code,{children:"req"}),", mengatur header)."]}),"\n",(0,i.jsxs)(n.li,{children:["Mengakhiri response tanpa harus mengeksekusi router (misalnya, jika otorisasi gagal, middleware dapat mengirimkan response ",(0,i.jsx)(n.em,{children:"error 403"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Memanggil fungsi middleware berikutnya dalam stack dengan memanggil ",(0,i.jsx)(n.code,{children:"next()"}),". Jika ",(0,i.jsx)(n.code,{children:"next()"})," tidak dipanggil, siklus akan terhenti di middleware tersebut."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-penggunaan-umum-middleware",children:"\ud83d\udca1 Penggunaan Umum Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Middleware sering digunakan untuk:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Logging"})," (Pencatatan): Mencatat setiap permintaan yang masuk."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Otentikasi/Otorisasi"}),": Memeriksa apakah pengguna sudah login atau memiliki izin yang tepat sebelum mengizinkan akses ke rute."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Validasi Data"}),": Memastikan data dalam ",(0,i.jsx)(n.code,{children:"req.body"})," valid sebelum data diproses oleh router."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Kompresi"}),": Mengompres response sebelum dikirim ke klien (menggunakan library seperti compression)."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-ilustrasi-siklus-request-dan-middleware",children:"\ud83d\udcca Ilustrasi Siklus Request dan Middleware"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Middleware Stack",src:a(36211).A+"",width:"497",height:"361"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.em,{children:["Source: ",(0,i.jsx)(n.a,{href:"https://dev.to/ghvstcode/understanding-express-middleware-a-beginners-guide-g73",children:"https://dev.to/ghvstcode/understanding-express-middleware-a-beginners-guide-g73"})]})}),"\n",(0,i.jsx)(n.h3,{id:"\ufe0f-penjelasan-siklus-middleware-alur-request",children:"\u261d\ufe0f Penjelasan Siklus Middleware (Alur Request)"}),"\n",(0,i.jsx)(n.p,{children:"Berikut penjelasan alur siklus Middleware pada contoh kasus di atas pada aplikasi Express.js."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Klien (Browser/Aplikasi) mengirimkan Request HTTP ke server Express.js."}),"\n",(0,i.jsxs)(n.li,{children:["Middleware 1 ",(0,i.jsx)(n.strong,{children:"Logging"}),": Request diterima dan melewati middleware pertama (melakukan logging).","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Jika Middleware 1 memanggil ",(0,i.jsx)(n.code,{children:"next()"})," dan permintaan berlanjut ke tahap berikutnya."]}),"\n",(0,i.jsxs)(n.li,{children:["Jika Middleware 1 mengirimkan response (misalnya, ",(0,i.jsx)(n.code,{children:"res.send()"}),"), siklus berakhir dan response dikirim kembali ke Klien."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Middleware 2 ",(0,i.jsx)(n.strong,{children:"User Auth"}),": Permintaan melewati middleware kedua (melakukan autentikasi)","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Jika autentikasi berhasil Middleware 2, yang mungkin akan menambahkan informasi pengguna ke object ",(0,i.jsx)(n.code,{children:"req"})," (misalnya, ",(0,i.jsx)(n.code,{children:"req.user = user_data"}),") sebelum memanggil ",(0,i.jsx)(n.code,{children:"next()"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Jika autentikasi gagal Middleware 2 mengirim response error dan siklus berakhir (misalnya, ",(0,i.jsx)(n.code,{children:"res.status(401).send('Unauthorized')"})," atau ",(0,i.jsx)(n.code,{children:"res.end()"}),")."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Middleware 3 ",(0,i.jsx)(n.strong,{children:"JSON Parsing"}),": Permintaan melewati middleware ketiga (melakukan ",(0,i.jsx)(n.em,{children:"body-parser"})," untuk memproses data JSON).","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Permintaan bergerak ke Middleware 3 JSON Parsing (biasanya menggunakan ",(0,i.jsx)(n.code,{children:"express.json()"}),"), middleware ini akan menguraikan string JSON tersebut dan mengubahnya menjadi objek JavaScript, menyimpannya di ",(0,i.jsx)(n.code,{children:"req.body"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Selanjutnya akan memanggil ",(0,i.jsx)(n.code,{children:"next()"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Middleware 4 ",(0,i.jsx)(n.strong,{children:"Static Files"}),": Permintaan mencapai middleware Static Files (biasanya menggunakan ",(0,i.jsx)(n.code,{children:"express.static()"}),"). Middleware ini memeriksa apakah URL permintaan sesuai dengan file statis (seperti gambar, CSS, atau JavaScript) di folder statis aplikasi.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Jika ditemukan file yang cocok, middleware ini akan mengakhiri siklus dengan segera mengirimkan HTTP Response yang berisi file tersebut."}),"\n",(0,i.jsxs)(n.li,{children:["Jika tidak ada file statis yang cocok, panggil ",(0,i.jsx)(n.code,{children:"next()"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Handler Rute (",(0,i.jsx)(n.strong,{children:"App Routing"}),"): Jika permintaan telah melewati semua middleware dan belum diakhiri, permintaan mencapai App Routing (Penentuan Rute Aplikasi), yaitu handler rute yang sesuai dengan URL permintaan (",(0,i.jsx)(n.code,{children:"app.get('/users', ...)"}),").","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Ini adalah tujuan akhir dari permintaan untuk logika bisnis. Handler rute akan memproses permintaan (misalnya, mengambil data dari database)."}),"\n",(0,i.jsxs)(n.li,{children:["Fungsi ini WAJIB mengakhiri siklus dengan mengirimkan HTTP Response (misalnya, ",(0,i.jsx)(n.code,{children:"res.send()"}),", ",(0,i.jsx)(n.code,{children:"res.json()"}),", atau ",(0,i.jsx)(n.code,{children:"res.render()"}),")."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Mengembalikan ",(0,i.jsx)(n.strong,{children:"HTTP Response"}),": Setelah salah satu fungsi (baik itu middleware statis, handler otentikasi, atau handler rute) mengirimkan response, siklus berakhir, dan HTTP Response dikirim kembali ke klien."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-function-middleware",children:"\u2699\ufe0f Function Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Semua fungsi middleware di Express.js memiliki format dasar:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"(req, res, next) => {\r\n    // Jalankan kode di sini\r\n    console.log('Permintaan masuk pada:', Date.now());\r\n\r\n    // Panggil next() untuk melanjutkan ke middleware berikutnya atau handler rute\r\n    next();\r\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"req"})," (request): Objek permintaan HTTP."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"res"})," (response): Objek respons HTTP."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"next"})," : Fungsi yang dipanggil untuk melanjutkan eksekusi ke fungsi middleware berikutnya. Memanggil ",(0,i.jsx)(n.code,{children:"next()"})," sangat penting kecuali middleware tersebut mengakhiri siklus permintaan-response (misalnya, dengan memanggil ",(0,i.jsx)(n.code,{children:"res.send()"}),")."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-jenis-jenis-middleware",children:"\ud83e\udde9 Jenis-Jenis Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Middleware dapat digunakan dalam berbagai cara:"}),"\n",(0,i.jsx)(n.h3,{id:"1\ufe0f\u20e3-middleware-tingkat-aplikasi-application-level-middleware",children:"1\ufe0f\u20e3 Middleware Tingkat Aplikasi (Application-level Middleware)"}),"\n",(0,i.jsxs)(n.p,{children:["Diterapkan ke seluruh aplikasi menggunakan ",(0,i.jsx)(n.code,{children:"app.use(middleware)"})," atau ",(0,i.jsx)(n.code,{children:"app.METHOD()"}),". Saat kita menerapkan Middleware pada tingkat aplikasi, secara otomatis Middleware itu akan aktif di seluruh route. Apabila kita ingin memakai Middleware hanya untuk route tertentu, kita dapat menambahkan pola route saat mengimplementasikan ",(0,i.jsx)(n.code,{children:"app.use()"}),", contohnya ",(0,i.jsx)(n.code,{children:'app.use("/student", middleware)'}),"."]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://expressjs.com/en/5x/api.html#app.use",children:"https://expressjs.com/en/5x/api.html#app.use"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://expressjs.com/en/5x/api.html#router.METHOD",children:"https://expressjs.com/en/5x/api.html#router.METHOD"})}),"\n"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const express = require('express');\r\nconst app = express();\r\n\r\n// Middleware ini akan dijalankan untuk SETIAP permintaan ke aplikasi\r\napp.use((req, res, next) => {\r\n    console.log(`URL yang diminta: ${req.originalUrl}`);\r\n    next();\r\n});\r\n\r\napp.get('/', (req, res) => {\r\n    res.send('Selamat datang!');\r\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2\ufe0f\u20e3-middleware-tingkat-router-router-level-middleware",children:"2\ufe0f\u20e3 Middleware Tingkat Router (Router-level Middleware)"}),"\n",(0,i.jsxs)(n.p,{children:["Diterapkan ke instance ",(0,i.jsx)(n.code,{children:"express.Router()"}),", membatasi fungsinya pada sekumpulan route tertentu. Middleware ini ditambahkan pada object Router yang kita buat dengan ",(0,i.jsx)(n.code,{children:"express.Router()"}),". Middleware ini akan secara otomatis diaktifkan saat request diterima oleh router ini. Mirip dengan Middleware Tingkat Aplikasi, apabila kita ingin program antara tersebut hanya aktif untuk route tertentu, kita juga bisa menambahkan route path saat menerapkan Middleware ini dengan menggunakan ",(0,i.jsx)(n.code,{children:"router.use(path, middleware)"}),"."]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://expressjs.com/en/5x/api.html#router.use",children:"https://expressjs.com/en/5x/api.html#router.use"})}),"\n"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const router = express.Router();\r\n\r\n// Middleware ini hanya akan dijalankan untuk rute yang menggunakan 'router'\r\nrouter.use((req, res, next) => {\r\n    console.log('Middleware Router berjalan');\r\n    next();\r\n});\r\n\r\nrouter.get('/users', (req, res) => {\r\n    res.send('Daftar Pengguna');\r\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3\ufe0f\u20e3-middleware-untuk-penanganan-error-error-handling-middleware",children:"3\ufe0f\u20e3 Middleware untuk Penanganan Error (Error-handling Middleware)"}),"\n",(0,i.jsxs)(n.p,{children:["Digunakan untuk menangani kesalahan / error yang terjadi di aplikasi kita. Cara penggunaannya serupa dengan Middleware Tingkat Aplikasi, tetapi yang membedakan adalah function callback-nya memiliki empat argumen (",(0,i.jsx)(n.code,{children:"err"}),", ",(0,i.jsx)(n.code,{children:"req"}),", ",(0,i.jsx)(n.code,{children:"res"}),", ",(0,i.jsx)(n.code,{children:"next"}),")`. Object error akan secara otomatis terisi dengan informasi mengenai kesalahan yang terjadi dalam aplikasi kita. Middleware ini sangat ideal saat kita ingin menampilkan informasi atau response yang berbeda ketika kesalahan terjadi dalam aplikasi kita."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"app.use((err, req, res, next) => {\r\n    console.error(err.stack);\r\n    res.status(500).send('Ada yang salah!');\r\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4\ufe0f\u20e3-built-in-middleware",children:"4\ufe0f\u20e3 Built-in Middleware"}),"\n",(0,i.jsxs)(n.p,{children:["Express.js sangat bergantung pada Middleware untuk menangani pemrosesan request dan response, termasuk di dalamnya adalah ",(0,i.jsx)(n.em,{children:"Built-in Middleware"}),", yaitu middleware yang sudah ada secara default (bawaan) di ExpressJS."]}),"\n",(0,i.jsx)(n.p,{children:"Beberapa Built-in Middleware yang sering digunakan:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Function"}),(0,i.jsx)(n.th,{children:"Keterangan"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"express.json()"})}),(0,i.jsx)(n.td,{children:"yaitu middleware yang melakukan parsing request body menjadi JavaScript object"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"express.text()"})}),(0,i.jsx)(n.td,{children:"yaitu middleware yang melakukan parsing request body menjadi string"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"express.raw()"})}),(0,i.jsx)(n.td,{children:"yaitu middleware yang melakukan parsing request body menjadi Buffer"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"express.urlencoded()"})}),(0,i.jsx)(n.td,{children:"yaitu middleware yang melakukan parsing request body form menjadi object"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"express.static()"})}),(0,i.jsx)(n.td,{children:"yaitu middleware yang digunakan untuk melayani file static"})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const express = require('express');\r\nconst app = express();\r\nconst path = require('path'); // Modul path bawaan Node.js\r\n\r\n// Menggunakan express.static() untuk mengakses file dari folder 'public'\r\n// Klien dapat mengakses file di folder ini tanpa menentukan jalur folder 'public' di URL\r\napp.use(express.static(path.join(__dirname, 'public')));\r\n\r\napp.listen(3000, () => {\r\n  console.log('Server berjalan di http://localhost:3000');\r\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"5\ufe0f\u20e3-third-party-middleware",children:"5\ufe0f\u20e3 Third-party Middleware"}),"\n",(0,i.jsx)(n.p,{children:"Yaitu middleware yang dibuat oleh pihak lain/pihak ketiga. Untuk menggunakannya, kita harus terlebih dahulu menambah dependency middleware-nya ke dalam project kita."}),"\n",(0,i.jsx)(n.h2,{id:"-contoh-penggunaan",children:"\ud83d\udca1 Contoh Penggunaan"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Membuat function Middleware."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// Middleware untuk logging request\r\nconst loggerMiddleware = (req, res, next) => {\r\n    console.log(`Menerima Request method: ${req.method} ${req.url}`);\r\n    next(); // PENTING: Memanggil next() untuk melanjutkan ke handler berikutnya\r\n};\r\n\r\n// Middleware untuk menambahkan header X-Powered-By\r\nconst poweredHeaderMiddleware = (req, res, next) => {\r\n    res.setHeader('X-Powered-By', 'Express Middleware');\r\n    next(); // PENTING: Memanggil next() untuk melanjutkan ke handler berikutnya\r\n};\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Menggunakan Middleware."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const app = express();\r\n\r\n// Pemanggilan middleware dengan app.use harus sesuai urutan function middleware yang diinginkan\r\n// dan ditempatkan sebelum route handler\r\napp.use(loggerMiddleware);\r\napp.use(poweredHeaderMiddleware);\r\n\r\n// Route handler untuk endpoint /hello\r\napp.get('/hello', (req, res) => {\r\n    res.send('Hello World!');\r\n});\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Output console log:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Menerima Request method: GET /hello\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Jika kita menambahkan route baru, misal dengan endpoint ",(0,i.jsx)(n.code,{children:"/ucup"}),", maka akan menghasilan log yang sama:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"app.get('/hello', (req, res) => {\r\n    res.send('Hello World!');\r\n});\r\n\r\napp.get('/ucup', (req, res) => {\r\n    res.send('Hello Ucup!');\r\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:"Output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Menerima Request method: GET /hello\r\n\r\nMenerima Request method: GET /ucup\n"})}),"\n",(0,i.jsx)(n.h3,{id:"-menambahkan-middleware-query-api-key",children:"\ud83d\udd10 Menambahkan Middleware Query Api Key"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// Middleware untuk logging request\r\nconst loggerMiddleware = (req, res, next) => {\r\n    console.log(`Menerima Request method: ${req.method} ${req.url}`);\r\n    next(); // PENTING: Memanggil next() untuk melanjutkan ke handler berikutnya\r\n};\r\n\r\n// Middleware untuk menambahkan header X-Powered-By\r\nconst poweredHeaderMiddleware = (req, res, next) => {\r\n    res.setHeader('X-Powered-By', 'Express Middleware');\r\n    next(); // PENTING: Memanggil next() untuk melanjutkan ke handler berikutnya\r\n};\r\n\r\n// Middleware untuk validasi API Key\r\nconst apiKeyMiddleware = (req, res, next) => {\r\n    const apiKey = req.query.apiKey;\r\n    if (apiKey && apiKey === 'test123') {\r\n        next(); // API key valid, lanjutkan ke handler berikutnya\r\n    } else {\r\n        res.status(403).end();\r\n    }\r\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:"Urutan pemanggilan Middleware diubah setelah logger:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// Pemanggilan middleware dengan app.use harus sesuai urutan function middleware yang diinginkan\r\n// dan ditempatkan sebelum route handler\r\napp.use(loggerMiddleware);\r\napp.use(apiKeyMiddleware); // Middleware untuk validasi API Key setelah logger\r\napp.use(poweredHeaderMiddleware);\r\n\r\n// Route handler untuk endpoint /hello\r\napp.get('/hello', (req, res) => {\r\n    res.send('Hello World!');\r\n});\r\n\r\napp.get('/ucup', (req, res) => {\r\n    res.send('Hello Ucup!');\r\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"-manipulasi-request",children:"\ud83d\udcdd Manipulasi Request"}),"\n",(0,i.jsx)(n.p,{children:"Karena Request itu adalah JavaScript Object, kita juga bisa memanipulasi Request Object di Middleware. Misalnya mengubah attribute atau menambah attribute baru, agar bisa digunakan di Middleware selanjutnya, atau di Route."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// Middleware untuk menambahkan waktu request\r\nconst timeMiddleware = (req, res, next) => {\r\n    req.requestTime = Date.now();\r\n    next();\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Memanggil Middleware:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// Pemanggilan middleware dengan app.use harus sesuai urutan function middleware yang diinginkan\r\n// dan ditempatkan sebelum route handler\r\napp.use(loggerMiddleware);\r\napp.use(apiKeyMiddleware); // Middleware untuk validasi API Key setelah logger\r\napp.use(poweredHeaderMiddleware);\r\napp.use(timeMiddleware); // Middleware untuk menambahkan waktu request\n"})}),"\n",(0,i.jsx)(n.p,{children:"Memanggil request di router:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"app.get('/time', (req, res) => {\r\n    const currentTime = req.requestTime; // Mengambil waktu (requestTime) dari middleware dateTimeMiddleware\r\n    res.send(`Request received at: ${currentTime}`);\r\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-fullcode-dengan-unit-test",children:"\ud83d\udd25 Fullcode dengan Unit Test"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const request = require('supertest');\r\nconst express = require('express');\r\n\r\n// Middleware untuk logging request\r\nconst loggerMiddleware = (req, res, next) => {\r\n    console.log(`Menerima Request method: ${req.method} ${req.url}`);\r\n    next(); // PENTING: Memanggil next() untuk melanjutkan ke handler berikutnya\r\n};\r\n\r\n// Middleware untuk menambahkan header X-Powered-By\r\nconst poweredHeaderMiddleware = (req, res, next) => {\r\n    res.setHeader('X-Powered-By', 'Express Middleware');\r\n    next(); // PENTING: Memanggil next() untuk melanjutkan ke handler berikutnya\r\n};\r\n\r\n// Middleware untuk validasi API Key\r\nconst apiKeyMiddleware = (req, res, next) => {\r\n    const apiKey = req.query.apiKey;\r\n    if (apiKey && apiKey === 'test123') {\r\n        next(); // API key valid, lanjutkan ke handler berikutnya\r\n    } else {\r\n        res.status(403).end();\r\n    }\r\n};\r\n\r\n// Middleware untuk menambahkan waktu request\r\nconst timeMiddleware = (req, res, next) => {\r\n    req.requestTime = Date.now();\r\n    next();\r\n}\r\n\r\nconst app = express();\r\n\r\n// Pemanggilan middleware dengan app.use harus sesuai urutan function middleware yang diinginkan\r\n// dan ditempatkan sebelum route handler\r\napp.use(loggerMiddleware);\r\napp.use(apiKeyMiddleware); // Middleware untuk validasi API Key setelah logger\r\napp.use(poweredHeaderMiddleware);\r\napp.use(timeMiddleware); // Middleware untuk menambahkan waktu request\r\n\r\n// Route handler untuk endpoint /hello\r\napp.get('/hello', (req, res) => {\r\n    res.send('Hello World!');\r\n});\r\n\r\napp.get('/ucup', (req, res) => {\r\n    res.send('Hello Ucup!');\r\n});\r\n\r\napp.get('/time', (req, res) => {\r\n    const currentTime = req.requestTime; // Mengambil waktu (requestTime) dari middleware dateTimeMiddleware\r\n    res.send(`Request received at: ${currentTime}`);\r\n});\r\n\r\n// Test untuk middleware dan endpoint /hello\r\ntest('Test Response Middleware /hello endpoint', async () => {\r\n    const response = await request(app).get('/hello').query({ apiKey: 'test123' });\r\n    expect(response.headers['x-powered-by']).toBe('Express Middleware');\r\n    expect(response.status).toBe(200);\r\n    expect(response.text).toBe('Hello World!');\r\n});\r\n\r\ntest('Test Response Middleware /ucup endpoint', async () => {\r\n    const response = await request(app).get('/ucup').query({ apiKey: 'test123' });\r\n    expect(response.headers['x-powered-by']).toBe('Express Middleware');\r\n    expect(response.status).toBe(200);\r\n    expect(response.text).toBe('Hello Ucup!');\r\n});\r\n\r\ntest('Test Response Middleware Unauthorized /ucup endpoint', async () => {\r\n    const response = await request(app).get('/ucup');\r\n    expect(response.status).toBe(403);\r\n});\r\n\r\ntest('Test Response Middleware Time /time endpoint', async () => {\r\n    const response = await request(app).get('/time').query({ apiKey: 'test123' });\r\n    expect(response.headers['x-powered-by']).toBe('Express Middleware');\r\n    expect(response.status).toBe(200);\r\n    expect(response.text).toContain('Request received at:'); // Menggunakan toContain karena waktu akan berubah-ubah setiap request\r\n});\n"})})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},92837:(e,n,a)=>{a.d(n,{A:()=>r});const r=a.p+"assets/images/middleware-87fd08431102914846f759e962f5589b.png"},36211:(e,n,a)=>{a.d(n,{A:()=>r});const r=a.p+"assets/images/middleware2-1a16b17a3228a75a21930330f280b7ca.png"},28453:(e,n,a)=>{a.d(n,{R:()=>d,x:()=>l});var r=a(96540);const i={},s=r.createContext(i);function d(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);