"use strict";(globalThis.webpackChunktimposu=globalThis.webpackChunktimposu||[]).push([[49299],{14470(e,n,a){a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"docker-image-basic/docker-file-and-build","title":"Docker File & Build","description":"1\ufe0f\u20e3 Dockerfile","source":"@site/tutorial/docker/05-docker-image-basic/04-docker-file-and-build.md","sourceDirName":"05-docker-image-basic","slug":"/docker-image-basic/docker-file-and-build","permalink":"/docker/docker-image-basic/docker-file-and-build","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Docker File & Build"},"sidebar":"tutorialSidebar","previous":{"title":"Menghapus Docker Image","permalink":"/docker/docker-image-basic/delete-image"},"next":{"title":"Docker Push","permalink":"/docker/docker-image-basic/docker-push"}}');var s=a(74848),r=a(28453);const l={sidebar_position:4,title:"Docker File & Build"},d=void 0,c={},t=[{value:"1\ufe0f\u20e3 Dockerfile",id:"1\ufe0f\u20e3-dockerfile",level:2},{value:"\ud83e\udde0 Instruksi Dockerfile",id:"-instruksi-dockerfile",level:3},{value:"2\ufe0f\u20e3 Build (Membangun Image)",id:"2\ufe0f\u20e3-build-membangun-image",level:2},{value:"\ud83d\udc4d Tips Best Practices",id:"-tips-best-practices",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"1\ufe0f\u20e3-dockerfile",children:"1\ufe0f\u20e3 Dockerfile"}),"\n",(0,s.jsxs)(n.p,{children:["Dockerfile adalah sebuah file teks tanpa ekstensi yang berisi serangkaian instruksi untuk membangun sebuah Docker Image secara otomatis. Dockerfile harus disimpan dengan nama file ",(0,s.jsx)(n.code,{children:"Dockefile"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"-instruksi-dockerfile",children:"\ud83e\udde0 Instruksi Dockerfile"}),"\n",(0,s.jsx)(n.p,{children:"Berikut adalah Struktur Instruksi Dockerfile yang Paling Sering Digunakan:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"FROM"})}),": Menentukan base image (pondasi).","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Contoh: ",(0,s.jsx)(n.code,{children:"FROM alpine:3.21"})," atau ",(0,s.jsx)(n.code,{children:"FROM eclipse-temurin:21-jre"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"WORKDIR"})}),": Menentukan direktori kerja di dalam kontainer. Semua perintah setelah ini akan dijalankan di folder tersebut.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Contoh: ",(0,s.jsx)(n.code,{children:"WORKDIR /app"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"COPY / ADD"})}),": Menyalin file dari laptop/host ke dalam image.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Contoh: ",(0,s.jsx)(n.code,{children:"COPY . ."})," (Menyalin semua isi folder saat ini ke ",(0,s.jsx)(n.code,{children:"WORKDIR"}),")."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"RUN"})}),": Menjalankan perintah saat proses pembuatan image (seperti instalasi paket).","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Contoh: ",(0,s.jsx)(n.code,{children:"RUN apk add --no-cache curl"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ENV"}),": Mengatur variabel lingkungan (Environment Variables).","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Contoh: ",(0,s.jsx)(n.code,{children:"ENV APP_PORT=8080"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"EXPOSE"})}),": Memberi tahu Docker bahwa aplikasi mendengarkan di port tertentu (hanya dokumentasi).","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Contoh: ",(0,s.jsx)(n.code,{children:"EXPOSE 8080"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"CMD / ENTRYPOINT"})}),": Menentukan perintah yang dijalankan saat kontainer dimulai.\nContoh: ",(0,s.jsx)(n.code,{children:'CMD ["java", "-jar", "app.jar"]'})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Contoh sebuah docker file dalam file ",(0,s.jsx)(n.code,{children:"Dockerfile"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:'FROM eclipse-temurin:21-jre\nLABEL version="1.0"\nLABEL maintainer="Ucup Topekox" email="ucup@gmail.com" environment="development"\nENV DATABASE_NAME=perpustakaan\nCOPY Hello.class Hello.class\nCMD ["java", "Hello"]\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["Instruksi Dockerfile akan dibahas lebih dalam pada materi ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.a,{href:"/docker/docker-image-advance",children:"Docker Image - Advance"})}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"2\ufe0f\u20e3-build-membangun-image",children:"2\ufe0f\u20e3 Build (Membangun Image)"}),"\n",(0,s.jsx)(n.p,{children:"Setelah Dockerfile selesai ditulis, kita harus mengubahnya menjadi Image menggunakan perintah docker build."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"docker build -t <nama-image>:<tag> .\n"})}),"\n",(0,s.jsx)(n.p,{children:"Contoh:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"docker image build -t topekox/first-dockerfile:0.0.3 .\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"-t"})})," (tag): Memberikan nama dan versi pada image."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"."})})," (titik): Menentukan ",(0,s.jsx)(n.strong,{children:"Build Context"}),". Titik berarti Docker akan mencari Dockerfile di folder saat ini dan hanya bisa mengakses file di folder tersebut."]}),"\n"]}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsxs)(n.p,{children:["Jika kita hanya membangun image untuk keperluan testing atau dijalankan di komputer sendiri menggunakan Docker Compose, kita ",(0,s.jsx)(n.strong,{children:"TIDAK WAJIB"})," menggunakan namespace."]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Contoh: ",(0,s.jsx)(n.code,{children:"docker build -t app-java:1.0 ."})]}),"\n"]}),(0,s.jsxs)(n.p,{children:["Jika kita berencana melakukan ",(0,s.jsx)(n.code,{children:"docker push"})," ke Docker Hub, maka namespace (Username Anda) ",(0,s.jsx)(n.strong,{children:"WAJIB"})," ada. Tanpa namespace, Docker tidak akan tahu ke akun mana image tersebut harus diunggah."]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Format: ",(0,s.jsx)(n.code,{children:"[USERNAME]/[NAMA_IMAGE]:[TAG]"})]}),"\n",(0,s.jsxs)(n.li,{children:["Contoh: ",(0,s.jsx)(n.code,{children:"docker build -t ucupdev/app-java:1.0 ."})]}),"\n"]})]}),"\n",(0,s.jsx)(n.h2,{id:"-tips-best-practices",children:"\ud83d\udc4d Tips Best Practices"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Gunakan ",(0,s.jsx)(n.code,{children:".dockerignore"})]}),": Buat file bernama ",(0,s.jsx)(n.code,{children:".dockerignore"})," untuk mengecualikan folder besar seperti ",(0,s.jsx)(n.code,{children:"target/"}),", ",(0,s.jsx)(n.code,{children:"node_modules/"}),", atau .",(0,s.jsx)(n.code,{children:"git/"})," agar tidak ikut terkirim ke Docker Daemon saat proses build."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Satu Kontainer, Satu Proses"}),": Jangan mencoba menjalankan database dan web server di dalam satu Dockerfile yang sama. Gunakan Docker Compose untuk itu."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Hapus Cache Package Manager"}),": Selalu gunakan ",(0,s.jsx)(n.code,{children:"--no-cache"})," pada Alpine atau ",(0,s.jsx)(n.code,{children:"&& rm -rf /var/lib/apt/lists/*"})," pada Ubuntu agar image tetap ramping."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Gunakan User Non-Root"}),": Untuk alasan keamanan selalu gunakan instruksi ",(0,s.jsx)(n.code,{children:"USER"}),", jangan gunakan ",(0,s.jsx)(n.strong,{children:"root"})," user demi keamanan."]}),"\n"]}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsxs)(n.p,{children:["Perintah ",(0,s.jsx)(n.code,{children:"docker build"}),' akan di-deprecated / dianggap "legacy", dan akan dihapus di masa mendatang. Docker sedang beralih ke mesin pembuat image baru yang lebih canggih bernama ',(0,s.jsx)(n.strong,{children:"BuildKit"}),"."]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Cara Mengatasinya"})}),(0,s.jsx)(n.p,{children:"Kita memiliki dua pilihan utama untuk menghilangkan peringatan ini:"}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Cara Cepat: Gunakan Environment Variable"})}),"\n"]}),(0,s.jsxs)(n.p,{children:["Kita bisa memaksa Docker menggunakan BuildKit tanpa instalasi tambahan dengan menambahkan variabel ",(0,s.jsx)(n.code,{children:"DOCKER_BUILDKIT=1"})," sebelum perintah build:"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"DOCKER_BUILDKIT=1 docker build -t nama-image:tag .\n"})}),(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Cara Permanen: Instal Docker Buildx (Direkomendasikan)"})}),"\n"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Install Plugin di Mac (Untuk OS Linux sesuaikan dengan Distro masing-masing):"}),"\n"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"brew install docker-buildx\n"})}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Konfigurasi agar Docker mengenalinya:"}),"\n"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/.docker/cli-plugins\nln -sfn $(which docker-buildx) ~/.docker/cli-plugins/docker-buildx\n"})}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Gunakan perintah baru, kita bisa menggunakan perintah ",(0,s.jsx)(n.code,{children:"buildx"})," yang lebih modern:"]}),"\n"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker buildx build -t nama-image:tag .\n"})})]}),"\n",(0,s.jsxs)(n.admonition,{type:"warning",children:[(0,s.jsxs)(n.p,{children:["Dalam beberapa kasus image yang dibuild di Mac (arsitektur ",(0,s.jsx)(n.strong,{children:"ARM64"}),") tidak kompatibel jika dijalankan di Linux (arsitektur ",(0,s.jsx)(n.strong,{children:"AMD64"}),").\nUntuk mengatasinya, kita harus melakukan ",(0,s.jsx)(n.strong,{children:"cross-compilation"})," saat melakukan build di Mac agar hasilnya bisa dijalankan di Linux."]}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Melalui Command Line (Docker Build)"}),"\n"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker build --platform linux/amd64 -t nama-image-anda:latest .\n"})}),(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Catatan: Flag ",(0,s.jsx)(n.code,{children:"--platform linux/amd64"})," akan memaksa Docker di Mac untuk membuat image versi Intel/AMD (x86_64) yang cocok untuk Linux"]})}),(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"Melalui Docker Compose"}),"\n"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"services:\n  nginx:\n    build: .\n    platform: linux/amd64  # <--- Tambahkan baris ini\n    container_name: webserver\n    # ... konfigurasi lainnya\n"})}),(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:["Solusi Terbaik: ",(0,s.jsx)(n.strong,{children:"Multi-Platform Build"})]}),"\n"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker buildx build --platform linux/amd64,linux/arm64 -t username/repo:tag --push .\n"})}),(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Catatan: Metode ",(0,s.jsx)(n.code,{children:"--push"})," langsung mengunggah ke Docker Hub karena lokal Docker tidak bisa menyimpan dua varian arsitektur sekaligus dalam satu tag secara default."]})})]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},28453(e,n,a){a.d(n,{R:()=>l,x:()=>d});var i=a(96540);const s={},r=i.createContext(s);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);