"use strict";(globalThis.webpackChunktimposu=globalThis.webpackChunktimposu||[]).push([[72998],{25932(n,e,t){t.r(e),t.d(e,{assets:()=>o,contentTitle:()=>d,default:()=>l,frontMatter:()=>r,metadata:()=>a,toc:()=>u});const a=JSON.parse('{"id":"springboot/springboot-jpa-hibernate/many-to-many-create","title":"Many-to-Many Create","description":"Proses Create Data atau menyimpan data pada Many-to-Many sesuai dengan contoh kasus sebelumnya, di mana banyak Siswa (Student) bisa mengambil banyak Mata Pelajaran (Course) sekaligus. Karena database tidak bisa menghubungkan mereka langsung, Hibernate akan membuat tabel tengah/tabel bantuan (course_student) secara otomatis.","source":"@site/tutorial/spring/springboot/springboot-jpa-hibernate/23-many-to-many-create.md","sourceDirName":"springboot/springboot-jpa-hibernate","slug":"/springboot/springboot-jpa-hibernate/many-to-many-create","permalink":"/spring/springboot/springboot-jpa-hibernate/many-to-many-create","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":23,"frontMatter":{"sidebar_position":23,"title":"Many-to-Many Create"},"sidebar":"tutorialSidebar","previous":{"title":"Many-to-Many Mapping","permalink":"/spring/springboot/springboot-jpa-hibernate/many-to-many"},"next":{"title":"Many-to-Many Read","permalink":"/spring/springboot/springboot-jpa-hibernate/many-to-many-read"}}');var s=t(74848),i=t(28453);const r={sidebar_position:23,title:"Many-to-Many Create"},d=void 0,o={},u=[{value:"\ud83d\ude80 Implementasi Entity",id:"-implementasi-entity",level:2},{value:"1\ufe0f\u20e3 Entity <code>Student</code> (Sisi Owner)",id:"1\ufe0f\u20e3-entity-student-sisi-owner",level:3},{value:"2\ufe0f\u20e3 Entity <code>Course</code> (Sisi Inverse)",id:"2\ufe0f\u20e3-entity-course-sisi-inverse",level:3},{value:"\ud83d\udee2 Implementasi DAO",id:"-implementasi-dao",level:2},{value:"\u25b6\ufe0f Main Class",id:"\ufe0f-main-class",level:2}];function c(n){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(e.p,{children:["Proses ",(0,s.jsx)(e.strong,{children:"Create Data"})," atau menyimpan data pada ",(0,s.jsx)(e.strong,{children:"Many-to-Many"})," sesuai dengan contoh kasus sebelumnya, di mana banyak Siswa (",(0,s.jsx)(e.code,{children:"Student"}),") bisa mengambil banyak Mata Pelajaran (",(0,s.jsx)(e.code,{children:"Course"}),") sekaligus. Karena database tidak bisa menghubungkan mereka langsung, Hibernate akan membuat ",(0,s.jsx)(e.strong,{children:"tabel tengah/tabel bantuan"})," (",(0,s.jsx)(e.code,{children:"course_student"}),") secara otomatis."]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"Hibernate",src:t(75896).A+"",width:"835",height:"236"})}),"\n",(0,s.jsx)(e.h2,{id:"-implementasi-entity",children:"\ud83d\ude80 Implementasi Entity"}),"\n",(0,s.jsxs)(e.h3,{id:"1\ufe0f\u20e3-entity-student-sisi-owner",children:["1\ufe0f\u20e3 Entity ",(0,s.jsx)(e.code,{children:"Student"})," (Sisi Owner)"]}),"\n",(0,s.jsxs)(e.p,{children:['Sisi "Owner" adalah entitas yang menentukan konfigurasi tabel penghubung menggunakan ',(0,s.jsx)(e.code,{children:"@JoinTable"}),"."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'@Entity\n@Table(name = "student")\npublic class Student {\n\n\t@Id\n\t@GeneratedValue(strategy = GenerationType.IDENTITY)\n\tprivate Integer id;\n\t\n\t@Column(name = "first_name")\n\tprivate String firstName;\n\t\n\t@Column(name = "last_name")\n\tprivate String lastName;\n\t\n\t@ManyToOne(cascade = {CascadeType.DETACH, CascadeType.MERGE, CascadeType.PERSIST, CascadeType.REFRESH})\n\t@JoinColumn(name = "class_id")\n\tprivate Classes classes;\n\t\n\t@OneToMany(\n\t\t\tfetch = FetchType.LAZY,\n\t\t\tcascade = CascadeType.ALL)\n\t@JoinColumn(name = "student_id") // FK yang akan dibuat di tabel \'grade\'\n\tprivate List<Grade> grades = new ArrayList<>();\n\t\n\t@ManyToMany(\n\t\t\tfetch = FetchType.LAZY,\n\t\t\tcascade = {CascadeType.DETACH, CascadeType.MERGE, CascadeType.PERSIST, CascadeType.REFRESH})\n\t@JoinTable(\n\t\t\tname = "course_student",\n\t\t\tjoinColumns = @JoinColumn(name = "student_id"),\n\t\t\tinverseJoinColumns = @JoinColumn(name = "course_id"))\n\tprivate Set<Course> courses = new HashSet<>();\n\t\n\tpublic Student() {\t\t\n\t}\n\n\tpublic Student(String firstName, String lastName) {\n\t\tthis.firstName = firstName;\n\t\tthis.lastName = lastName;\n\t}\n\n\tpublic Integer getId() {\n\t\treturn id;\n\t}\n\n\tpublic void setId(Integer id) {\n\t\tthis.id = id;\n\t}\n\n\tpublic String getFirstName() {\n\t\treturn firstName;\n\t}\n\n\tpublic void setFirstName(String firstName) {\n\t\tthis.firstName = firstName;\n\t}\n\n\tpublic String getLastName() {\n\t\treturn lastName;\n\t}\n\n\tpublic void setLastName(String lastName) {\n\t\tthis.lastName = lastName;\n\t}\n\t\n\tpublic Classes getClasses() {\n\t\treturn classes;\n\t}\n\n\tpublic void setClasses(Classes classes) {\n\t\tthis.classes = classes;\n\t}\n\n\tpublic List<Grade> getGrades() {\n\t\treturn grades;\n\t}\n\n\tpublic void setGrades(List<Grade> grades) {\n\t\tthis.grades = grades;\n\t}\n\n\tpublic void addGrade(Grade grade) {\n\t\tif (grades == null) {\n\t\t\tgrades = new ArrayList<>();\n\t\t}\n\t\t\n\t\tgrades.add(grade);\n\t}\n\t\n\tpublic Set<Course> getCourses() {\n\t\treturn courses;\n\t}\n\n\tpublic void setCourses(Set<Course> courses) {\n\t\tthis.courses = courses;\n\t}\n\t\n\tpublic void addCourse(Course course) {\n\t\tif (course == null) return;\n\t\t\n\t\tif (courses == null) {\n\t\t\tcourses = new HashSet<>();\n\t\t}\n\t\t\n\t\tif (!courses.contains(course)) {\n\t\t\tcourses.add(course);\n\t\t\tcourse.addStudent(this);\n\t\t}\n\t}\n\n\t@Override\n\tpublic String toString() {\n\t\treturn "Student [id=" + id + ", firstName=" + firstName + ", lastName=" + lastName + "]";\n\t}\n}\n'})}),"\n",(0,s.jsxs)(e.h3,{id:"2\ufe0f\u20e3-entity-course-sisi-inverse",children:["2\ufe0f\u20e3 Entity ",(0,s.jsx)(e.code,{children:"Course"})," (Sisi Inverse)"]}),"\n",(0,s.jsxs)(e.p,{children:["Sisi ini menggunakan atribut ",(0,s.jsx)(e.code,{children:"mappedBy"})," yang merujuk pada nama variabel di class ",(0,s.jsx)(e.code,{children:"Student"}),"."]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'@Entity\n@Table(name = "course")\npublic class Course {\n\n\t@Id\n\t@GeneratedValue(strategy = GenerationType.IDENTITY)\n\tprivate Integer id;\n\t\n\t@Column(name = "course_name")\n\tprivate String courseName;\n\t\n\t@ManyToMany(\n\t\t\tmappedBy = "courses",\n\t\t\tfetch = FetchType.LAZY,\n\t\t\tcascade = {CascadeType.DETACH, CascadeType.MERGE, CascadeType.PERSIST, CascadeType.REFRESH})\n\tprivate Set<Student> students = new HashSet<>();\n\t\n\tpublic Course() { }\n\t\n\tpublic Course(String courseName) {\n\t\tthis.courseName = courseName;\n\t}\n\n\tpublic Integer getId() {\n\t\treturn id;\n\t}\n\n\tpublic void setId(Integer id) {\n\t\tthis.id = id;\n\t}\n\n\tpublic String getCourseName() {\n\t\treturn courseName;\n\t}\n\n\tpublic void setCourseName(String courseName) {\n\t\tthis.courseName = courseName;\n\t}\n\t\n\tpublic Set<Student> getStudents() {\n\t\treturn students;\n\t}\n\n\tpublic void setStudents(Set<Student> students) {\n\t\tthis.students = students;\n\t}\n\n\tpublic void addStudent(Student student) {\n\t\tif (student == null) return;\n\t\t\n\t\tif (students == null) {\n\t\t\tstudents = new HashSet<>();\n\t\t}\n\t\t\n\t\tif (!students.contains(student)) {\n\t\t\tstudents.add(student);\n\t\t\tstudent.addCourse(this);\n\t\t}\n\t}\n\n\t@Override\n\tpublic String toString() {\n\t\treturn "Course [id=" + id + ", courseName=" + courseName + "]";\n\t}\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"-implementasi-dao",children:"\ud83d\udee2 Implementasi DAO"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Membuat Interface DAO:"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"public interface SchoolDAO {\n\t\n\tvoid saveStudent(Student student);\n\t\n}\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Implementasi DAO simpan ",(0,s.jsx)(e.code,{children:"Student"})," sekaligus dengan ",(0,s.jsx)(e.code,{children:"Course"}),"-nya:"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"@Repository\npublic class SchoolDAOImpl implements SchoolDAO {\n\n\tprivate EntityManager entityManager;\n\t\n\tpublic SchoolDAOImpl(EntityManager entityManager) {\n\t\tthis.entityManager = entityManager;\n\t}\n\n\t@Override\n\t@Transactional\n\tpublic void saveStudent(Student student) {\n\t\tentityManager.merge(student); // Menggunakan merge lebih aman untuk relasi Many to Many\n\t}\n\t\n}\n"})}),"\n",(0,s.jsxs)(e.admonition,{type:"info",children:[(0,s.jsxs)(e.p,{children:["Berikut adalah alasan mengapa ",(0,s.jsx)(e.code,{children:"session.merge()"}),' dianggap lebih "aman" dan fleksibel, terutama dalam kasus relasi kompleks seperti ',(0,s.jsx)(e.strong,{children:"Many-to-Many"}),":"]}),(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"persist()"})}),": Hanya bisa menerima objek yang benar-benar baru (Transient). Jika Anda mencoba melakukan ",(0,s.jsx)(e.code,{children:"persist()"})," pada objek yang sudah punya ID (misalnya mengambil data dari Session lama atau menerima kiriman data dari Frontend), Hibernate akan melempar error ",(0,s.jsx)(e.code,{children:"PersistentObjectException"})," atau ",(0,s.jsx)(e.code,{children:"Detached entity passed to persist"}),"."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:(0,s.jsx)(e.code,{children:"merge()"})}),": Sangat cerdas. Ia mengecek ID objek:","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Jika ID ",(0,s.jsx)(e.strong,{children:"tidak ada"}),", ia melakukan ",(0,s.jsx)(e.code,{children:"INSERT"})," (seperti ",(0,s.jsx)(e.code,{children:"persist"}),")."]}),"\n",(0,s.jsxs)(e.li,{children:["Jika ID ",(0,s.jsx)(e.strong,{children:"sudah ada"}),", ia akan mencari data di database, lalu melakukan ",(0,s.jsx)(e.code,{children:"UPDATE"})," jika ada perubahan."]}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,s.jsx)(e.h2,{id:"\ufe0f-main-class",children:"\u25b6\ufe0f Main Class"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Kita akan membuat data ",(0,s.jsx)(e.code,{children:"Student"})," beserta ",(0,s.jsx)(e.code,{children:"Course"}),"-nya."]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'@SpringBootApplication\npublic class Application {\n\n\tpublic static void main(String[] args) {\n\t\tSpringApplication.run(Application.class, args);\n\t}\n\n\t// Bean ini akan dieksekusi di command line\n\t@Bean\n\tpublic CommandLineRunner commandLineRunner(SchoolDAO dao) {\n\t\treturn runner -> {\n\n\t\t\tcreateStudentAndCourse(dao);\n\t\t\t\n\t\t};\n\t}\n\n\tprivate void createStudentAndCourse(SchoolDAO dao) {\n\t\tStudent student1 = new Student("Abu", "Nawas");\n\t\t\n\t\tCourse course1 = new Course("Bahasa Arab");\n\t\tCourse course2 = new Course("Sejarah");\n\t\t\n\t\tstudent1.addCourse(course1);\n\t\tstudent1.addCourse(course2);\n\t\t\n\t\tdao.saveStudent(student1);\n\t\t\n\t\tSystem.out.println("Save Student 1  = " + student1);\n\t\tSystem.out.println("Student 1 Course= " + student1.getCourses());\n\t}\n}\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Output pada hibernate console:"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"Hibernate: create table course (id integer not null auto_increment, course_name varchar(255), primary key (id)) engine=InnoDB\nHibernate: create table course_student (student_id integer not null, course_id integer not null, primary key (student_id, course_id)) engine=InnoDB\nHibernate: alter table course_student add constraint FKlmj50qx9k98b7li5li74nnylb foreign key (course_id) references course (id)\nHibernate: alter table course_student add constraint FK4xxxkt1m6afc9vxp3ryb0xfhi foreign key (student_id) references student (id)\nHibernate: insert into student (class_id,first_name,last_name) values (?,?,?)\nHibernate: insert into course (course_name) values (?)\nHibernate: insert into course (course_name) values (?)\nHibernate: insert into course_student (student_id,course_id) values (?,?)\nHibernate: insert into course_student (student_id,course_id) values (?,?)\nSave Student 1  = Student [id=6, firstName=Abu, lastName=Nawas]\nStudent 1 Course= [Course [id=1, courseName=Bahasa Arab], Course [id=2, courseName=Sejarah]]\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Cek data dalam database:"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"mysql> select * from student;\n+----+------------+-----------+----------+\n| id | first_name | last_name | class_id |\n+----+------------+-----------+----------+\n|  6 | Abu        | Nawas     |     NULL |\n+----+------------+-----------+----------+\n\nmysql> select * from course;\n+----+-------------+\n| id | course_name |\n+----+-------------+\n|  1 | Bahasa Arab |\n|  2 | Sejarah     |\n+----+-------------+\n\nmysql> select * from course_student;\n+------------+-----------+\n| student_id | course_id |\n+------------+-----------+\n|          6 |         1 |\n|          6 |         2 |\n+------------+-----------+\n"})}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Source Code"}),": ",(0,s.jsx)(e.a,{href:"https://github.com/TimposuLabs/belajar-springboot-jpa-hibernate-advance/tree/main/13-hibernate-many-to-many",children:"https://github.com/TimposuLabs/belajar-springboot-jpa-hibernate-advance/tree/main/13-hibernate-many-to-many"})]})})]})}function l(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(c,{...n})}):c(n)}},28453(n,e,t){t.d(e,{R:()=>r,x:()=>d});var a=t(96540);const s={},i=a.createContext(s);function r(n){const e=a.useContext(i);return a.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),a.createElement(i.Provider,{value:e},n.children)}},75896(n,e,t){t.d(e,{A:()=>a});const a=t.p+"assets/images/many-to-many-6aa81602769493b1c2929977a8044fb9.png"}}]);