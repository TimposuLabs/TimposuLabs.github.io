"use strict";(globalThis.webpackChunktimposu=globalThis.webpackChunktimposu||[]).push([[4404],{28453(e,n,t){t.d(n,{R:()=>i,x:()=>o});var a=t(96540);const s={},r=a.createContext(s);function i(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(r.Provider,{value:n},e.children)}},33447(e,n,t){t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"springboot/springboot-mvc-security/jdbc-auth-custom-table","title":"JDBC Auth Custom Tables","description":"Materi ini akan membahas cara mengonfigurasi Spring Security JDBC jika kita memiliki struktur tabel database sendiri yang berbeda dari standar default Spring.","source":"@site/tutorial/spring/springboot/springboot-mvc-security/10-jdbc-auth-custom-table.md","sourceDirName":"springboot/springboot-mvc-security","slug":"/springboot/springboot-mvc-security/jdbc-auth-custom-table","permalink":"/spring/springboot/springboot-mvc-security/jdbc-auth-custom-table","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"title":"JDBC Auth Custom Tables"},"sidebar":"tutorialSidebar","previous":{"title":"JDBC Authentication BCrypt","permalink":"/spring/springboot/springboot-mvc-security/jdbc-authentication-bcrypt"},"next":{"title":"Spring Boot JPA/Hibernate","permalink":"/spring/springboot/springboot-jpa-hibernate/"}}');var s=t(74848),r=t(28453);const i={sidebar_position:10,title:"JDBC Auth Custom Tables"},o=void 0,u={},c=[{value:"1\ufe0f\u20e3 Mengapa Menggunakan Custom Tables?",id:"1\ufe0f\u20e3-mengapa-menggunakan-custom-tables",level:2},{value:"2\ufe0f\u20e3 Contoh Skema Database Kustom",id:"2\ufe0f\u20e3-contoh-skema-database-kustom",level:2},{value:"3\ufe0f\u20e3 Konfigurasi: Menggunakan Custom Query",id:"3\ufe0f\u20e3-konfigurasi-menggunakan-custom-query",level:2},{value:"4\ufe0f\u20e3 Hal Penting yang Harus Diperhatikan",id:"4\ufe0f\u20e3-hal-penting-yang-harus-diperhatikan",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Materi ini akan membahas cara mengonfigurasi ",(0,s.jsx)(n.strong,{children:"Spring Security JDBC"})," jika kita memiliki struktur tabel database sendiri yang berbeda dari standar default Spring."]}),"\n",(0,s.jsxs)(n.p,{children:["Di dunia nyata, seringkali kita harus bekerja dengan desain database kustom. Contoh kasus tabel bernama ",(0,s.jsx)(n.code,{children:"accounts"})," dan ",(0,s.jsx)(n.code,{children:"roles"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"1\ufe0f\u20e3-mengapa-menggunakan-custom-tables",children:"1\ufe0f\u20e3 Mengapa Menggunakan Custom Tables?"}),"\n",(0,s.jsxs)(n.p,{children:["Secara default, Spring Security mencari tabel bernama ",(0,s.jsx)(n.code,{children:"users"})," dan ",(0,s.jsx)(n.code,{children:"authorities"}),". Namun, kita mungkin ingin menggunakan nama lain, misalnya:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Tabel ",(0,s.jsx)(n.code,{children:"accounts"})," bukan ",(0,s.jsx)(n.code,{children:"users"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Kolom ",(0,s.jsx)(n.code,{children:"user_id"})," bukan ",(0,s.jsx)(n.code,{children:"username"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Kolom ",(0,s.jsx)(n.code,{children:"user_password"})," bukan ",(0,s.jsx)(n.code,{children:"password"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Kolom ",(0,s.jsx)(n.code,{children:"active"})," bukan ",(0,s.jsx)(n.code,{children:"enabled"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Tabel ",(0,s.jsx)(n.code,{children:"roles"})," bukan ",(0,s.jsx)(n.code,{children:"authorities"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Kolom ",(0,s.jsx)(n.code,{children:"user_id"})," bukan ",(0,s.jsx)(n.code,{children:"username"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Kolom ",(0,s.jsx)(n.code,{children:"user_role"})," bukan ",(0,s.jsx)(n.code,{children:"authority"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"2\ufe0f\u20e3-contoh-skema-database-kustom",children:"2\ufe0f\u20e3 Contoh Skema Database Kustom"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Misalkan kita memiliki tabel SQL sebagai berikut:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE `accounts` (\n  `user_id` varchar(50) NOT NULL,\n  `user_password` char(68) NOT NULL,\n  `active` tinyint NOT NULL,\n  PRIMARY KEY (`user_id`)\n);\n\nCREATE TABLE `roles` (\n  `user_id` varchar(50) NOT NULL,\n  `user_role` varchar(50) NOT NULL,\n  UNIQUE KEY `authorities5_idx_1` (`user_id`,`user_role`),\n  CONSTRAINT `authorities5_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `accounts` (`user_id`)\n);\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Insert data:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"INSERT INTO `accounts` \nVALUES \n-- Password = test123 --\n('aco','$2a$12$J5TR1bl3yRrUJ5LHAezNH.r8Bs9zCOuTsop2PAmUxmUEP7j7V5Mke',1), \n('ade','$2a$12$J5TR1bl3yRrUJ5LHAezNH.r8Bs9zCOuTsop2PAmUxmUEP7j7V5Mke',1),\n('ucup','$2a$12$J5TR1bl3yRrUJ5LHAezNH.r8Bs9zCOuTsop2PAmUxmUEP7j7V5Mke',1);\n\nINSERT INTO `roles` \nVALUES \n('aco','ROLE_GUEST'),\n('ade','ROLE_GUEST'),\n('ade','ROLE_USERS'),\n('ucup','ROLE_GUEST'),\n('ucup','ROLE_USERS'),\n('ucup','ROLE_ADMIN');\n"})}),"\n",(0,s.jsx)(n.h2,{id:"3\ufe0f\u20e3-konfigurasi-menggunakan-custom-query",children:"3\ufe0f\u20e3 Konfigurasi: Menggunakan Custom Query"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class SecurityConfig {\n\n\t// membuat user konfigurasi dari database\n\t@Bean\n\tpublic UserDetailsManager userDetailsManager(DataSource dataSource) {\n\t\tJdbcUserDetailsManager jdbcUserDetailsManager = new JdbcUserDetailsManager(dataSource);\n\t\t\n\t\t// set query untuk mendapatkan user berdasarkan username\n\t\tjdbcUserDetailsManager.setUsersByUsernameQuery(\n\t\t\t\t"SELECT user_id, user_password, active FROM members WHERE user_id=?");\n\t\t\n\t\t// set query untuk mendapatkan role berdasarkan username\n\t\tjdbcUserDetailsManager.setAuthoritiesByUsernameQuery(\n\t\t\t\t"SELECT user_id, user_role FROM roles WHERE user_id=?");\n\t\t\n\t\treturn jdbcUserDetailsManager;\t\t\n\t}\n\t\n\t// Bean untuk Password Encoder BCrypt\n\t@Bean\n\tpublic PasswordEncoder passwordEncoder() {\n\t    // Angka 12 adalah \'High security\' (log rounds) cocok production. Standar adalah 10-12.\n\t    return new BCryptPasswordEncoder(12);\n\t}\n\t\n\t// konfig custom login page\n\t@Bean\n\tpublic SecurityFilterChain filterChain(HttpSecurity httpSecurity) throws Exception {\n\t\t\n\t\thttpSecurity.authorizeHttpRequests(configurer -> \n\t\t\t\t\tconfigurer\n\t\t\t\t\t\t.requestMatchers("/").hasRole("GUEST")\n\t\t\t\t\t\t.requestMatchers("/user/**").hasAnyRole("USERS", "ADMIN")\n\t\t\t\t\t\t.requestMatchers("/admin/**").hasRole("ADMIN")\n\t\t\t\t\t\t.anyRequest().authenticated()\n\t\t\t\t).formLogin(form ->\n\t\t\t\t\tform\n\t\t\t\t\t\t.loginPage("/loginPage")\n\t\t\t\t\t\t.loginProcessingUrl("/authentication")\n\t\t\t\t\t\t.permitAll()\n\t\t\t\t).logout(logout -> \n\t\t\t\t\tlogout.permitAll()\n\t\t\t\t).exceptionHandling(configurer ->\n\t\t\t\t\tconfigurer.accessDeniedPage("/access-denied")\n\t\t\t\t);\n\t\t\n\t\treturn httpSecurity.build();\n\t}\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"4\ufe0f\u20e3-hal-penting-yang-harus-diperhatikan",children:"4\ufe0f\u20e3 Hal Penting yang Harus Diperhatikan"}),"\n",(0,s.jsx)(n.p,{children:"Saat menulis kueri kustom, pastikan urutan kolom yang dipilih sesuai dengan harapan Spring Security:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Users Query"}),": Harus mengembalikan 3 kolom dengan urutan: ",(0,s.jsx)(n.code,{children:"username"}),", ",(0,s.jsx)(n.code,{children:"password"}),", dan ",(0,s.jsx)(n.code,{children:"enabled"})," (boolean/tinyint)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Authorities Query"}),": Harus mengembalikan 2 kolom dengan urutan: ",(0,s.jsx)(n.code,{children:"username"})," dan ",(0,s.jsx)(n.code,{children:"authority"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Integrasi dengan BCrypt"}),": Meskipun tabelnya kustom, pastikan kolom  ",(0,s.jsx)(n.code,{children:"user_password"})," tetap berisi hash BCrypt"]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Source Code"}),": ",(0,s.jsx)(n.a,{href:"https://github.com/TimposuLabs/belajar-springboot-mvc-security/tree/main/12-belajar-springboot-security-jdbc-custom-tables",children:"https://github.com/TimposuLabs/belajar-springboot-mvc-security/tree/main/12-belajar-springboot-security-jdbc-custom-tables"})]})})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);