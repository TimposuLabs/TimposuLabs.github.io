"use strict";(self.webpackChunktimposu=self.webpackChunktimposu||[]).push([[63743],{93694:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>d,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"docker-compose","title":"Docker Compose","description":"\ud83e\udd14 Apa itu Docker Compose?","source":"@site/tutorial/docker/13-docker-compose.md","sourceDirName":".","slug":"/docker-compose","permalink":"/docker/docker-compose","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"sidebar_position":14,"title":"Docker Compose"},"sidebar":"tutorialSidebar","previous":{"title":"Docker Volume","permalink":"/docker/docker-volume"},"next":{"title":"Docker Registry","permalink":"/docker/docker-registry"}}');var i=a(74848),r=a(28453);const o={sidebar_position:14,title:"Docker Compose"},l=void 0,d={},c=[{value:"\ud83e\udd14 Apa itu Docker Compose?",id:"-apa-itu-docker-compose",level:2},{value:"1\ufe0f\u20e3 Top Elemen dalam Docker Compose",id:"1\ufe0f\u20e3-top-elemen-dalam-docker-compose",level:2},{value:"1. <code>services</code> (Elemen Utama)",id:"1-services-elemen-utama",level:3},{value:"2. <code>networks</code>",id:"2-networks",level:3},{value:"3. <code>volumes</code>",id:"3-volumes",level:3},{value:"4. <code>configs</code>",id:"4-configs",level:3},{value:"5. <code>secrets</code>",id:"5-secrets",level:3},{value:"Contoh Implementasi Gabungan (YAML):",id:"contoh-implementasi-gabungan-yaml",level:3},{value:"2\ufe0f\u20e3 Perintah Utama Docker Compose (CLI)",id:"2\ufe0f\u20e3-perintah-utama-docker-compose-cli",level:2},{value:"3\ufe0f\u20e3 Fitur Unggulan Docker Compose",id:"3\ufe0f\u20e3-fitur-unggulan-docker-compose",level:2},{value:"4\ufe0f\u20e3 Tips",id:"4\ufe0f\u20e3-tips",level:2},{value:"5\ufe0f\u20e3 Contoh Implementasi",id:"5\ufe0f\u20e3-contoh-implementasi",level:2},{value:"Skenario 1: Membuat Docker Compose",id:"skenario-1-membuat-docker-compose",level:3},{value:"Skenario 2: Menggunakan Network",id:"skenario-2-menggunakan-network",level:3},{value:"Skenario 3: Menambahkan Volume",id:"skenario-3-menambahkan-volume",level:3},{value:"Skenario 4: Docker Compose menggunakan Aplikasi dengan Database dan Docker Volume",id:"skenario-4-docker-compose-menggunakan-aplikasi-dengan-database-dan-docker-volume",level:3}];function t(n){const e={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h2,{id:"-apa-itu-docker-compose",children:"\ud83e\udd14 Apa itu Docker Compose?"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Docker Compose"})," adalah alat (tool) untuk mendefinisikan dan menjalankan aplikasi Docker multi-kontainer. Docker Compose dapat memudahkan pengelolaan layanan yang saling terhubung, seperti frontend, backend API, dan database."]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Masalah"}),": Bayangkan kita harus mengetik perintah ",(0,i.jsx)(e.code,{children:"docker run"})," yang sangat panjang untuk MySQL, lalu satu lagi untuk Java, lalu satu lagi untuk Nginx, dan menghubungkan jaringan mereka satu per satu secara manual."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Solusi"}),": Dengan Docker Compose, kita menulis semua konfigurasi tersebut ke dalam sebuah file bernama ",(0,i.jsx)(e.code,{children:"compose.yaml"})," (dulu ",(0,i.jsx)(e.code,{children:"docker-compose.yml"}),"), lalu menjalankannya secara bersamaan."]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"Docker Compose dapat membantu mengotomatisasi eksekusi banyak kontainer dengan satu perintah, menyatukan berbagai macam Dockerfile menjadi satu file dan menentukan tumpukan aplikasi dalam sebuah file."}),"\n",(0,i.jsx)(e.admonition,{type:"tip",children:(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Baca:"})," ",(0,i.jsx)(e.a,{href:"https://yaml.org/",children:"Dokumen Resmi YAML"}),"."]})}),"\n",(0,i.jsx)(e.admonition,{type:"tip",children:(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Baca:"})," ",(0,i.jsx)(e.a,{href:"https://docs.docker.com/compose/",children:"Dokumentasi Resmi Docker Compose"}),"."]})}),"\n",(0,i.jsx)(e.h2,{id:"1\ufe0f\u20e3-top-elemen-dalam-docker-compose",children:"1\ufe0f\u20e3 Top Elemen dalam Docker Compose"}),"\n",(0,i.jsxs)(e.h3,{id:"1-services-elemen-utama",children:["1. ",(0,i.jsx)(e.code,{children:"services"})," (Elemen Utama)"]}),"\n",(0,i.jsx)(e.p,{children:"Elemen ini adalah bagian paling penting. Di sini kita mendefinisikan kontainer-kontainer yang membentuk aplikasi kita."}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Fungsi"}),": Menentukan citra (image), port yang dibuka, variabel lingkungan, dan bagaimana kontainer harus dijalankan."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Contoh"}),": Kita bisa memiliki satu service untuk web-app (Java/Spring), satu untuk database (PostgreSQL), dan satu untuk cache (Redis)."]}),"\n"]}),"\n",(0,i.jsxs)(e.h3,{id:"2-networks",children:["2. ",(0,i.jsx)(e.code,{children:"networks"})]}),"\n",(0,i.jsx)(e.p,{children:"Elemen ini digunakan untuk mengatur jalur komunikasi antar kontainer."}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Fungsi"}),": Secara default, Compose membuat satu jaringan untuk semua service. Namun, dengan elemen ini, kita bisa membuat jaringan terpisah (misal: jaringan frontend dan backend) untuk meningkatkan keamanan."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Manfaat"}),": Memungkinkan service saling memanggil menggunakan nama service (DNS) daripada alamat IP."]}),"\n"]}),"\n",(0,i.jsxs)(e.h3,{id:"3-volumes",children:["3. ",(0,i.jsx)(e.code,{children:"volumes"})]}),"\n",(0,i.jsx)(e.p,{children:"Elemen ini digunakan untuk mengelola penyimpanan data permanen."}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Fungsi"}),": Mendefinisikan tempat penyimpanan data di luar siklus hidup kontainer. Data dalam volume tidak akan hilang meskipun kontainer dihapus atau di-restart."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Penggunaan"}),": Sangat penting untuk database (seperti folder ",(0,i.jsx)(e.code,{children:"/var/lib/postgresql/data"}),") agar data transaksi kita tetap ada selamanya."]}),"\n"]}),"\n",(0,i.jsxs)(e.h3,{id:"4-configs",children:["4. ",(0,i.jsx)(e.code,{children:"configs"})]}),"\n",(0,i.jsx)(e.p,{children:"Elemen ini memungkinkan kita mengelola file konfigurasi secara eksternal tanpa harus membangun ulang (rebuild) image."}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Fungsi"}),": Memberikan file (seperti ",(0,i.jsx)(e.code,{children:"nginx.conf"})," atau ",(0,i.jsx)(e.code,{children:"settings.xml"}),") ke kontainer saat ia mulai berjalan. File ini bersifat ",(0,i.jsx)(e.em,{children:"read-only"})," (hanya baca)."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Kelebihan"}),": Kita bisa mengubah isi file konfigurasi di host, dan kontainer akan menggunakan versi terbaru saat dijalankan ulang."]}),"\n"]}),"\n",(0,i.jsxs)(e.h3,{id:"5-secrets",children:["5. ",(0,i.jsx)(e.code,{children:"secrets"})]}),"\n",(0,i.jsxs)(e.p,{children:["Elemen ini mirip dengan ",(0,i.jsx)(e.code,{children:"configs"}),", tetapi dirancang khusus untuk ",(0,i.jsx)(e.strong,{children:"data sensitif"}),"."]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Fungsi"}),": Digunakan untuk menyimpan kata sandi (password), sertifikat SSL, atau API Key secara aman. Docker akan memastikan data ini tidak terlihat di log atau saat perintah ",(0,i.jsx)(e.code,{children:"docker inspect"}),"."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Keamanan"}),": Data didekripsi dan diberikan ke kontainer hanya di dalam memori (RAM), tidak pernah ditulis ke disk kontainer dalam bentuk teks biasa."]}),"\n"]}),"\n",(0,i.jsxs)(e.admonition,{type:"info",children:[(0,i.jsxs)(e.p,{children:["Jika menggunakan ",(0,i.jsx)(e.strong,{children:"Colima di macOS"}),", kita perlu menginstall plugin Docker Compose via Homebrew."]}),(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Instal Docker Compose via Homebrew:"}),"\n"]}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"brew install docker-compose\n"})}),(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Hubungkan sebagai Plugin Docker:"}),"\n"]}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# Buat folder plugin jika belum ada\nmkdir -p ~/.docker/cli-plugins\n\n# Buat symlink dari binary Homebrew ke folder plugin Docker\nln -sfn $(which docker-compose) ~/.docker/cli-plugins/docker-compose\n"})}),(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Verifikasi:"}),"\n"]}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose version\n"})})]}),"\n",(0,i.jsx)(e.h3,{id:"contoh-implementasi-gabungan-yaml",children:"Contoh Implementasi Gabungan (YAML):"}),"\n",(0,i.jsxs)(e.p,{children:["File ini menggunakan format ",(0,i.jsx)(e.strong,{children:"YAML"})," yang mengandalkan spasi (",(0,i.jsx)(e.em,{children:"indentasi"}),"). Berikut adalah komponen utamanya:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"services:\n  app-java:\n    image: my-spring-app:latest\n    networks:\n      - backend-net\n    secrets:\n      - db_password\n    configs:\n      - source: app_config\n        target: /app/config/settings.properties\n\n  db-postgres:\n    image: postgres:16\n    networks:\n      - backend-net\n    volumes:\n      - db_data:/var/lib/postgresql/data\n\nnetworks:\n  backend-net: # Mendefinisikan network\n\nvolumes:\n  db_data:     # Mendefinisikan volume penyimpanan\n\nconfigs:\n  app_config:\n    file: ./configs/my_settings.properties\n\nsecrets:\n  db_password:\n    file: ./secrets/db_pass.txt\n"})}),"\n",(0,i.jsx)(e.h2,{id:"2\ufe0f\u20e3-perintah-utama-docker-compose-cli",children:"2\ufe0f\u20e3 Perintah Utama Docker Compose (CLI)"}),"\n",(0,i.jsx)(e.p,{children:"Untuk menjalankan script Docker Compose (harus berada di direktori yang sama) gunakan perintah:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"Menjalankan Semua Service:"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose up\n"})}),"\n",(0,i.jsx)(e.p,{children:"atau"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose up -d\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"-d"}),": Menjalankan di latar belakang (detached)."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:"Melihat Status Kontainer:"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose ps\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"Melihat Log Gabungan:"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose logs -f\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"Menghentikan Kontainer:"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose stop\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.em,{children:"Catatan: Menghentikan kontainer tapi tidak menghapusnya."})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"Menghentikan & Menghapus Semua:"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose down\n"})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.em,{children:"Catatan: Perintah ini akan menghapus kontainer dan network, tapi tetap menjaga Volume tetap aman."})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"Melakukan Scaling (Menambah jumlah kontainer):"})}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose up -d --scale app-java=3\n"})}),"\n",(0,i.jsx)(e.h2,{id:"3\ufe0f\u20e3-fitur-unggulan-docker-compose",children:"3\ufe0f\u20e3 Fitur Unggulan Docker Compose"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Service Discovery (DNS)"}),": Di dalam file Compose, kita bisa memanggil database cukup dengan nama database (sesuai nama servicenya). Docker otomatis mengatur IP-nya."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:(0,i.jsx)(e.code,{children:"depends_on"})}),": Mengatur urutan startup. Contoh: Jangan jalankan aplikasi Java sebelum MySQL siap."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Environment Variables"}),": Kita bisa menggunakan file ",(0,i.jsx)(e.code,{children:".env"})," di samping file ",(0,i.jsx)(e.code,{children:"compose.yaml"})," untuk menyimpan password agar file YAML kita tetap bersih dan aman."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Profiles"}),": Kita bisa membagi konfigurasi untuk ",(0,i.jsx)(e.code,{children:"dev"})," (pengembangan) dan ",(0,i.jsx)(e.code,{children:"prod"})," (produksi) dalam satu file yang sama."]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"4\ufe0f\u20e3-tips",children:"4\ufe0f\u20e3 Tips"}),"\n",(0,i.jsx)(e.p,{children:"Nama File: Docker sekarang resmi menyarankan nama file compose.yaml daripada docker-compose.yml. Docker Compose Specification\nValidasi: Gunakan perintah docker compose config untuk mengecek apakah ada kesalahan pengetikan spasi/indentasi pada file YAML kita sebelum dijalankan.\nKeep it Simple: Jangan masukkan terlalu banyak layanan dalam satu file Compose jika tidak saling berhubungan. Pisahkan berdasarkan kebutuhan proyek."}),"\n",(0,i.jsx)(e.h2,{id:"5\ufe0f\u20e3-contoh-implementasi",children:"5\ufe0f\u20e3 Contoh Implementasi"}),"\n",(0,i.jsx)(e.h3,{id:"skenario-1-membuat-docker-compose",children:"Skenario 1: Membuat Docker Compose"}),"\n",(0,i.jsxs)(e.p,{children:["Kita akan membuat container Nginx dengan nama ",(0,i.jsx)(e.code,{children:"webserver"})," dengan posrt ",(0,i.jsx)(e.code,{children:"80"}),"."]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Buat file ",(0,i.jsx)(e.code,{children:"compose.yaml"}),":"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"services:\n  nginx:\n    container_name: webserver\n    image: nginx:stable-alpine\n    ports:\n      - 80:80\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Menjalankan script compose (harus berada di direktori yang sama):"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose up -d\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Uji coba menggunakan browser atau cURL:"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"curl localhost:80\n"})}),"\n",(0,i.jsx)(e.h3,{id:"skenario-2-menggunakan-network",children:"Skenario 2: Menggunakan Network"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Kita akan menambahkan elemen network dalam docker compose. Contoh kita akan membuat nework dengan nama ",(0,i.jsx)(e.code,{children:"backend-network"}),". Tahap pertama kita membuat network tersebut."]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker network create -d bridge backend-network \n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Karena sebelumnya kita sudah membuat network, maka kita perlu menambahkan ",(0,i.jsx)(e.code,{children:"external:true"}),"."]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"services:\n  nginx:\n    container_name: webserver\n    image: nginx:stable-alpine\n    ports:\n      - 80:80\n    networks:\n      - backend-network\n\nnetworks:\n  backend-network:\n    driver: bridge\n    external: true\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Jalankan ",(0,i.jsx)(e.code,{children:"docker compose"}),":"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose up -d\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Cek detail ",(0,i.jsx)(e.code,{children:"backend-network"}),":"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:'docker network inspect backend-network \n\n"Containers": {\n    "26095b2a258642fc339468578003334e2f7f90dd533cdc9779bc6936e28a72db": {\n        "Name": "webserver",\n        "EndpointID": "884cf86b972918bc0497bf103b172a8f9142f8bcad709bbe658ff02a3a0a5942",\n        "MacAddress": "4e:82:0e:b4:d3:18",\n        "IPv4Address": "172.18.0.2/16",\n        "IPv6Address": ""\n    }\n},\n'})}),"\n",(0,i.jsx)(e.h3,{id:"skenario-3-menambahkan-volume",children:"Skenario 3: Menambahkan Volume"}),"\n",(0,i.jsxs)(e.p,{children:["Disini kita akan menambahakan volume dan menambahkan konfigurasi MySQL seperti ",(0,i.jsx)(e.a,{href:"/docker/docker-volume",children:"materi Docker Volume sebelumnya"}),"."]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Menambahkan volume dan service dengan konfigurasi untuk MySQL:"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"services:\n  nginx:\n    container_name: webserver\n    image: nginx:stable-alpine\n    ports:\n      - 80:80\n    networks:\n      - backend-network\n\n  mysql:\n    container_name: mysql-db\n    image: mysql:8.4.7\n    environment:\n      - MYSQL_ROOT_PASSWORD=rahasia\n    networks:\n      - backend-network\n    volumes:\n      - mysql-data:/var/lib/mysql\n\nnetworks:\n  backend-network:\n    driver: bridge\n    external: true\n\nvolumes:\n    mysql-data:\n      driver: local\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Jalankan container:"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose up -d\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Masuk ke dalam MySQL dan buat database ",(0,i.jsx)(e.code,{children:"belajar"}),":"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker exec -it mysql-db mysql -u root -p\n\nEnter password: \n\nmysql> create database belajar;\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Uji coba: Compose down untuk menghapus isi dalam resource compose down dan kemudian up lagi untuk menguji Volume."}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose down\n\ndocker compose up\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Kemudian cek ulang databasenya, seharusnya database sebelumnya yang dibuat masih ada."}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"mysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| belajar            |\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n"})}),"\n",(0,i.jsx)(e.h3,{id:"skenario-4-docker-compose-menggunakan-aplikasi-dengan-database-dan-docker-volume",children:"Skenario 4: Docker Compose menggunakan Aplikasi dengan Database dan Docker Volume"}),"\n",(0,i.jsxs)(e.p,{children:["Disini kita akan menggunakan contoh pada studi kasus sebelumnya pada ",(0,i.jsx)(e.a,{href:"/docker/docker-volume",children:"materi Docker Volume"})," menggunakan Docker Compose, dengan menggunakan Springboot sebagai aplikasi backend."]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"Docker Volume Database",src:a(62020).A+"",width:"1291",height:"462"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"1."})," ",(0,i.jsx)(e.strong,{children:"Membuat Docker Compose"})]}),"\n",(0,i.jsxs)(e.p,{children:["Kita akan membuat Docker Compose dengan catatan ",(0,i.jsx)(e.code,{children:"network"})," dan ",(0,i.jsx)(e.code,{children:"volume"})," sudah ada, kemudian pertama kita akan membuat service mysql pada docker compose. Kenapa dalam skenario ini perlu membuat container database terlebih dahulu? karena aplikasi Springboot yang akan kita jalankan menggunakan database MySQL, jika dijalankan bersama, maka Springboot error karena database belum dibuat, sehingga dia belum bisa terhubung ke database. Kecuali jika sebelumnya database telah dibuat pada Volume yang sama pada Docker Compose."]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"services:\n  mysql:\n    container_name: mysql-db\n    image: mysql:8.4.7\n    environment:\n      - MYSQL_ROOT_PASSWORD=rahasia\n    networks:\n      - backend-network\n    volumes:\n      - mysql-data:/var/lib/mysql\n\nnetworks:\n  backend-network:\n    driver: bridge\n    external: true\n\nvolumes:\n    mysql-data:\n      driver: local\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"2."})," ",(0,i.jsx)(e.strong,{children:"Jalankan container"})," dengan Docker Compose:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose up -d\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"3."})," ",(0,i.jsx)(e.strong,{children:"Buat database"})," di dalam container:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker exec -it mysql-db mysql -u root -p\n\nEnter password: \n\nmysql> create database belajar;\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"4."})," ",(0,i.jsx)(e.strong,{children:"Membuat Service Springboot"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"Setelah membuat container MySQL dan databasenya, selanjutnya menambahkan service Spring Boot pada Docker Compose:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"services:\n  mysql:\n    container_name: mysql-db\n    image: mysql:8.4.7\n    environment:\n      - MYSQL_ROOT_PASSWORD=rahasia\n    networks:\n      - backend-network\n    volumes:\n      - mysql-data:/var/lib/mysql\n\nspringboot:\n    image: timposulabs/springboot-crud-demo:v1.1 # springboot app image\n    networks:\n      - backend-network\n    environment:\n      - DB_ADD=mysql-db\n      - DB_PORT=3306\n      - DB_NAME=belajar\n      - DB_USER=root\n      - DB_PASS=rahasia\n    depends_on:\n      - mysql # Memastikan urutan startup, mysql jalan dulu baru springboot\n\nnetworks:\n  backend-network:\n    driver: bridge\n    external: true\n\nvolumes:\n    mysql-data:\n      driver: local\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"5."})," ",(0,i.jsx)(e.strong,{children:"Scaling"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"Karena pada contoh kasus ini kita akan membuat 2 kontainer aplikasi Spring Boot dari image yang sama kita perlu melakukan scaling."}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose up --scale springboot=2 -d\n"})}),"\n",(0,i.jsx)(e.admonition,{type:"warning",children:(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Penting"}),": Dalam compose scale, tidak diperkenangkan menggunakan ",(0,i.jsx)(e.code,{children:"container_name"}),", karena docker akan membuat name service secara otomatis secara berurutan."]})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"6."})," ",(0,i.jsx)(e.strong,{children:"Membuat Service Nginx"})]}),"\n",(0,i.jsxs)(e.p,{children:["Konfigurasi ",(0,i.jsx)(e.code,{children:"load-balancer.conf"}),", sesuaikan dengan nama container dengan service yang dibuat di Docker Compose. Untuk konfigurasi Nginx kita bisa melakukan beberapa cara di antaranya."]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Cara 1"}),": Terlebih dahulu mengetahui nama container Springboot, setelah itu dimasukan ke dalam konfigurasi Nginx:"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'docker ps\n\nCONTAINER ID   IMAGE                                   COMMAND                  CREATED          STATUS          PORTS                 NAMES\nade837254254   timposulabs/springboot-crud-demo:v1.1   "java org.springfram\u2026"   8 seconds ago    Up 8 seconds                          demo5-springboot-2\n0f53621156c5   timposulabs/springboot-crud-demo:v1.1   "java org.springfram\u2026"   24 seconds ago   Up 23 seconds                         demo5-springboot-1\n'})}),"\n",(0,i.jsxs)(e.p,{children:["Dari hasil di atas kita mendapatkan nama container Springboot ",(0,i.jsx)(e.code,{children:"demo5-springboot-1"})," dan ",(0,i.jsx)(e.code,{children:"demo5-springboot-2"}),":"]}),"\n",(0,i.jsxs)(e.p,{children:["File ",(0,i.jsx)(e.code,{children:"load-balancer.conf"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"upstream backend {\n  server demo5-springboot-1:8080;\n  server demo5-springboot-2:8080;\n}\n\nserver {\n  listen 80;\n\n  location / {\n    proxy_pass http://backend;\n  }\n}\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Cara 2"}),": Menggunakan configurasi dinamis, dimana kita menggunakan resolver internal Docker, agar Nginx bisa mencari IP secara dinamis:"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["File ",(0,i.jsx)(e.code,{children:"load-balancer.conf"}),":"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"server {\n  listen 80;\n  \n  # Gunakan resolver internal Docker agar Nginx bisa mencari IP secara dinamis\n  resolver 127.0.0.11 valid=5s;\n\n  location / {\n    # Gunakan variabel agar Nginx TETAP JALAN meskipun backend belum siap\n    # Sesuaikan dengan nama container pada service docker compose\n    set $target http://springboot:8080; \n    proxy_pass $target;\n  }\n}\n"})}),"\n",(0,i.jsxs)(e.admonition,{type:"info",children:[(0,i.jsx)(e.p,{children:"Gunakan resolver internal Docker agar Nginx bisa mencari IP secara dinamis, karena secara default Nginx akan mecari secara secara static. Jika tidak di set ke static maka Nginx terkadang tidak dapat menemukan container Springboot, jika nama container tidak sesuai."}),(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"127.0.0.11"})," adalah alamat IP internal yang digunakan oleh Docker sebagai server DNS bawaan (embedded DNS server) di dalam setiap kontainer."]})]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Konfigurasi ",(0,i.jsx)(e.code,{children:"dockerfile"}),":"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-dockerfile",children:"FROM nginx:stable-alpine\nCOPY load-balancer.conf /etc/nginx/conf.d/default.conf\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Build menjadi image:"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:"docker image build -t webserver:1.0 .\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"7."})," ",(0,i.jsx)(e.strong,{children:"Menambahkan service Nginx pada Docker Compose."})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"services:\n  mysql:\n    container_name: mysql-db\n    image: mysql:8.4.7\n    environment:\n      - MYSQL_ROOT_PASSWORD=rahasia\n    networks:\n      - backend-network\n    volumes:\n      - mysql-data:/var/lib/mysql\n\n  springboot:\n    image: timposulabs/springboot-crud-demo:v1.1 # springboot app image\n    networks:\n      - backend-network\n    environment:\n      - DB_ADD=mysql-db\n      - DB_PORT=3306\n      - DB_NAME=belajar\n      - DB_USER=root\n      - DB_PASS=rahasia\n    depends_on:\n      - mysql # Memastikan urutan startup, mysql jalan dulu baru springboot\n\n  nginx:\n    container_name: webserver\n    image: webserver:1.0 # custom image nginx yang sudah terintegrasi dengan springboot app\n    ports:\n      - 80:80\n    networks:\n      - backend-network\n    depends_on:\n      - springboot # Memastikan urutan startup, springboot jalan dulu baru nginx \n\nnetworks:\n  backend-network:\n    driver: bridge\n    external: true\n\nvolumes:\n    mysql-data:\n      driver: local\n"})}),"\n",(0,i.jsxs)(e.admonition,{type:"tip",children:[(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Troubleshooting"}),": Meskipun kita menggunakan ",(0,i.jsx)(e.code,{children:"depends_on"}),", Docker hanya menjamin kontainer ",(0,i.jsx)(e.code,{children:"mysql-db"})," sudah ",(0,i.jsx)(e.strong,{children:"berjalan (running)"}),", bukan ",(0,i.jsx)(e.strong,{children:"siap (ready)"})," menerima koneksi. Terkadang dalam beberapa kasus MySQL butuh waktu beberapa detik (bahkan lebih lama) untuk inisialisasi internal sebelum port 3306 bisa dipakai. Untuk mengatasi agar MySQL harus siap baru menjalankan service lain maka kita mengubah konfigurasinya sebagai berikut:"]}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'services:\n  mysql:\n    container_name: mysql-db\n    image: mysql:8.4.7\n    environment:\n      - MYSQL_ROOT_PASSWORD=rahasia\n    networks:\n      - backend-network\n    volumes:\n      - mysql-data:/var/lib/mysql\n    # Memastikan ,mysql-db siap (ready) menerima koneksi. \n    # MySQL butuh waktu beberapa detik untuk inisialisasi internal sebelum port 3306 bisa dipakai. \n    # Tambahkan juga file .env untuk value MYSQL_ROOT_PASSWORD=rahasia\n    healthcheck:\n      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p$MYSQL_ROOT_PASSWORD"]\n      interval: 5s\n      timeout: 5s\n      retries: 10\n\n  springboot:\n    image: timposulabs/springboot-crud-demo:v1.1 # springboot app image\n    networks:\n      - backend-network\n    environment:\n      - DB_ADD=mysql-db\n      - DB_PORT=3306\n      - DB_NAME=belajar\n      - DB_USER=root\n      - DB_PASS=rahasia\n    # Update depends_on agar menunggu kondisi healthy\n    depends_on:\n      mysql:\n        condition: service_healthy\n\n  nginx:\n    container_name: webserver\n    image: webserver:1.0 # custom image nginx yang sudah terintegrasi dengan springboot app\n    ports:\n      - 80:80\n    networks:\n      - backend-network\n    depends_on:\n      - springboot # Memastikan urutan startup, springboot jalan dulu baru nginx \n\nnetworks:\n  backend-network:\n    driver: bridge\n    external: true\n\nvolumes:\n    mysql-data:\n      driver: local\n'})}),(0,i.jsx)(e.p,{children:(0,i.jsxs)(e.em,{children:["Catatan: Buat juga file dengan nama ",(0,i.jsx)(e.code,{children:".env"})," dan masukan text value ",(0,i.jsx)(e.code,{children:"MYSQL_ROOT_PASSWORD=rahasia"})," di dalamnya."]})})]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"8."})," ",(0,i.jsx)(e.strong,{children:"Docker Compose Up:"})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"docker compose up --scale springboot=2 -d\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"9."})," ",(0,i.jsx)(e.strong,{children:"Uji coba aplikasi"})," dengan menggunakan Rest API Client seperti cURL, Postman dll, ke URL ",(0,i.jsx)(e.code,{children:"http://localhost:80/products/"}),":"]}),"\n",(0,i.jsx)(e.p,{children:"Contoh:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"curl -v http://localhost:80/products/ | jq .\n"})}),"\n",(0,i.jsx)(e.p,{children:"Uji coba dengan menggunakan method GET, POST, PUT dan DELETE."})]})}function m(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(t,{...n})}):t(n)}},62020:(n,e,a)=>{a.d(e,{A:()=>s});const s=a.p+"assets/images/docker8-9bd796fb84d4c57b8df3f4daa93853ee.png"},28453:(n,e,a)=>{a.d(e,{R:()=>o,x:()=>l});var s=a(96540);const i={},r=s.createContext(i);function o(n){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:o(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);