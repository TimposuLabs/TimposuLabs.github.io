"use strict";(globalThis.webpackChunktimposu=globalThis.webpackChunktimposu||[]).push([[69381],{14143(e,n,a){a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"docker-swarm-secret","title":"Docker Swarm Secret","description":"\ud83d\udd10 Implementasi Using Secrets dengan Docker Swarm","source":"@site/tutorial/docker/17-docker-swarm-secret.md","sourceDirName":".","slug":"/docker-swarm-secret","permalink":"/docker/docker-swarm-secret","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":18,"frontMatter":{"sidebar_position":18,"title":"Docker Swarm Secret"},"sidebar":"tutorialSidebar","previous":{"title":"Docker Swarm","permalink":"/docker/docker-swarm"}}');var s=a(74848),i=a(28453);const c={sidebar_position:18,title:"Docker Swarm Secret"},t=void 0,l={},d=[{value:"\ud83d\udd10 Implementasi Using Secrets dengan Docker Swarm",id:"-implementasi-using-secrets-dengan-docker-swarm",level:2},{value:"1\ufe0f\u20e3 Konsep Dasar",id:"1\ufe0f\u20e3-konsep-dasar",level:2},{value:"2\ufe0f\u20e3 Contoh Implementasi Lengkap",id:"2\ufe0f\u20e3-contoh-implementasi-lengkap",level:2},{value:"Step 1 \u2014 Inisialisasi Swarm (jika belum ada)",id:"step-1--inisialisasi-swarm-jika-belum-ada",level:3},{value:"Step 2 \u2014 Buat Secret",id:"step-2--buat-secret",level:3},{value:"Step 3 \u2014 Deploy Service dengan Secret",id:"step-3--deploy-service-dengan-secret",level:3},{value:"3\ufe0f\u20e3 Implementasi Menggunakan Docker Compose (Stack)",id:"3\ufe0f\u20e3-implementasi-menggunakan-docker-compose-stack",level:2},{value:"4\ufe0f\u20e3 Cara Aplikasi Membaca Secret",id:"4\ufe0f\u20e3-cara-aplikasi-membaca-secret",level:2},{value:"5\ufe0f\u20e3 Best Practices di Production",id:"5\ufe0f\u20e3-best-practices-di-production",level:2},{value:"\u2705 1. Jangan pakai environment variable untuk password",id:"-1-jangan-pakai-environment-variable-untuk-password",level:3},{value:"\u2705 2. Gunakan Stack bukan service manual",id:"-2-gunakan-stack-bukan-service-manual",level:3},{value:"\u2705 3. Gunakan Secret Rotation",id:"-3-gunakan-secret-rotation",level:3},{value:"\u2705 4. Gunakan Network Terpisah (Frontend\u2013Backend)",id:"-4-gunakan-network-terpisah-frontendbackend",level:3},{value:"6\ufe0f\u20e3 Perbedaan Secret vs Config",id:"6\ufe0f\u20e3-perbedaan-secret-vs-config",level:2},{value:"7\ufe0f\u20e3 Keamanan Internal Swarm",id:"7\ufe0f\u20e3-keamanan-internal-swarm",level:2},{value:"\ud83d\udd0e Cek Secret di Container",id:"-cek-secret-di-container",level:2}];function o(e){const n={code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"-implementasi-using-secrets-dengan-docker-swarm",children:"\ud83d\udd10 Implementasi Using Secrets dengan Docker Swarm"}),"\n",(0,s.jsx)(n.p,{children:"Pada Docker Swarm, secret digunakan untuk menyimpan data sensitif seperti:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Password database"}),"\n",(0,s.jsx)(n.li,{children:"API key"}),"\n",(0,s.jsx)(n.li,{children:"Token"}),"\n",(0,s.jsx)(n.li,{children:"Sertifikat SSL"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Swarm akan:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Menyimpan secret dalam bentuk ",(0,s.jsx)(n.strong,{children:"encrypted (Raft log encryption)"})]}),"\n",(0,s.jsx)(n.li,{children:"Mengirim secret hanya ke node yang menjalankan service terkait"}),"\n",(0,s.jsxs)(n.li,{children:["Me-mount secret sebagai file di ",(0,s.jsx)(n.code,{children:"/run/secrets/"})]}),"\n",(0,s.jsx)(n.li,{children:"Tidak menyimpannya di image atau environment variable"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"1\ufe0f\u20e3-konsep-dasar",children:"1\ufe0f\u20e3 Konsep Dasar"}),"\n",(0,s.jsx)(n.p,{children:"Saat kita membuat secret:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'echo "mypassword123" | docker secret create db_password -\n'})}),"\n",(0,s.jsx)(n.p,{children:"Secret tersebut:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Disimpan di manager node"}),"\n",(0,s.jsx)(n.li,{children:"Tidak bisa dibaca langsung (hanya bisa di-attach ke service)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"2\ufe0f\u20e3-contoh-implementasi-lengkap",children:"2\ufe0f\u20e3 Contoh Implementasi Lengkap"}),"\n",(0,s.jsx)(n.p,{children:"Misalnya kita ingin menjalankan MySQL di Swarm dengan password menggunakan secret."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.h3,{id:"step-1--inisialisasi-swarm-jika-belum-ada",children:"Step 1 \u2014 Inisialisasi Swarm (jika belum ada)"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker swarm init\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.h3,{id:"step-2--buat-secret",children:"Step 2 \u2014 Buat Secret"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'echo "StrongRootPass123!" | docker secret create mysql_root_password -\n'})}),"\n",(0,s.jsx)(n.p,{children:"Cek secret:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker secret ls\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.h3,{id:"step-3--deploy-service-dengan-secret",children:"Step 3 \u2014 Deploy Service dengan Secret"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker service create \\\r\n  --name mysql \\\r\n  --secret mysql_root_password \\\r\n  -e MYSQL_ROOT_PASSWORD_FILE=/run/secrets/mysql_root_password \\\r\n  mysql:8.0\n"})}),"\n",(0,s.jsx)(n.p,{children:"Perhatikan:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Kita menggunakan ",(0,s.jsx)(n.code,{children:"MYSQL_ROOT_PASSWORD_FILE"})]}),"\n",(0,s.jsxs)(n.li,{children:["Bukan ",(0,s.jsx)(n.code,{children:"MYSQL_ROOT_PASSWORD"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Karena ",(0,s.jsx)(n.em,{children:"secret"})," akan tersedia sebagai file di:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"/run/secrets/mysql_root_password\n"})}),"\n",(0,s.jsx)(n.h2,{id:"3\ufe0f\u20e3-implementasi-menggunakan-docker-compose-stack",children:"3\ufe0f\u20e3 Implementasi Menggunakan Docker Compose (Stack)"}),"\n",(0,s.jsxs)(n.p,{children:["File ",(0,s.jsx)(n.code,{children:"docker-stack.yml"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'version: "3.8"\r\n\r\nservices:\r\n  db:\r\n    image: mysql:8.0\r\n    environment:\r\n      MYSQL_ROOT_PASSWORD_FILE: /run/secrets/mysql_root_password\r\n    secrets:\r\n      - mysql_root_password\r\n    volumes:\r\n      - db_data:/var/lib/mysql\r\n\r\nvolumes:\r\n  db_data:\r\n\r\nsecrets:\r\n  mysql_root_password:\r\n    external: true\n'})}),"\n",(0,s.jsx)(n.p,{children:"Deploy stack:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker stack deploy -c docker-stack.yml mystack\n"})}),"\n",(0,s.jsx)(n.h2,{id:"4\ufe0f\u20e3-cara-aplikasi-membaca-secret",children:"4\ufe0f\u20e3 Cara Aplikasi Membaca Secret"}),"\n",(0,s.jsx)(n.p,{children:"Di dalam container, secret tersedia sebagai file."}),"\n",(0,s.jsx)(n.p,{children:"Contoh di Spring Boot:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-properties",children:"spring.datasource.password=${MYSQL_PASSWORD:}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Lalu di entrypoint script:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"export MYSQL_PASSWORD=$(cat /run/secrets/mysql_root_password)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Atau langsung gunakan ",(0,s.jsx)(n.code,{children:"_FILE"})," variable jika image mendukungnya."]}),"\n",(0,s.jsx)(n.h2,{id:"5\ufe0f\u20e3-best-practices-di-production",children:"5\ufe0f\u20e3 Best Practices di Production"}),"\n",(0,s.jsx)(n.h3,{id:"-1-jangan-pakai-environment-variable-untuk-password",children:"\u2705 1. Jangan pakai environment variable untuk password"}),"\n",(0,s.jsx)(n.p,{children:"Environment variable bisa terlihat lewat:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker inspect\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-2-gunakan-stack-bukan-service-manual",children:"\u2705 2. Gunakan Stack bukan service manual"}),"\n",(0,s.jsx)(n.p,{children:"Karena stack lebih rapi untuk production deployment."}),"\n",(0,s.jsx)(n.h3,{id:"-3-gunakan-secret-rotation",children:"\u2705 3. Gunakan Secret Rotation"}),"\n",(0,s.jsx)(n.p,{children:"Untuk mengganti secret:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker secret create mysql_root_password_v2 newpass.txt\r\ndocker service update --secret-rm mysql_root_password \\\r\n                      --secret-add mysql_root_password_v2 mysql\n"})}),"\n",(0,s.jsx)(n.h3,{id:"-4-gunakan-network-terpisah-frontendbackend",children:"\u2705 4. Gunakan Network Terpisah (Frontend\u2013Backend)"}),"\n",(0,s.jsx)(n.p,{children:"Seperti arsitektur yang sebelumnya kamu buat:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Nginx \u2192 frontend network"}),"\n",(0,s.jsx)(n.li,{children:"App \u2192 backend network"}),"\n",(0,s.jsx)(n.li,{children:"DB \u2192 backend only"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.em,{children:"Secret"})," hanya diberikan ke service yang membutuhkan."]}),"\n",(0,s.jsx)(n.h2,{id:"6\ufe0f\u20e3-perbedaan-secret-vs-config",children:"6\ufe0f\u20e3 Perbedaan Secret vs Config"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Feature"}),(0,s.jsx)(n.th,{children:"Secret"}),(0,s.jsx)(n.th,{children:"Config"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Data sensitif"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Encrypted"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"File mount"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Cocok untuk"}),(0,s.jsx)(n.td,{children:"Password"}),(0,s.jsx)(n.td,{children:"File konfigurasi"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"7\ufe0f\u20e3-keamanan-internal-swarm",children:"7\ufe0f\u20e3 Keamanan Internal Swarm"}),"\n",(0,s.jsx)(n.p,{children:"Secret pada Docker Swarm:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Disimpan encrypted dalam Raft log"}),"\n",(0,s.jsx)(n.li,{children:"Hanya dikirim ke node yang menjalankan task"}),"\n",(0,s.jsx)(n.li,{children:"Hilang saat container dihentikan"}),"\n",(0,s.jsx)(n.li,{children:"Tidak masuk ke image layer"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"-cek-secret-di-container",children:"\ud83d\udd0e Cek Secret di Container"}),"\n",(0,s.jsx)(n.p,{children:"Masuk ke container:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker exec -it <container_id> sh\r\ncat /run/secrets/mysql_root_password\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},28453(e,n,a){a.d(n,{R:()=>c,x:()=>t});var r=a(96540);const s={},i=r.createContext(s);function c(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);