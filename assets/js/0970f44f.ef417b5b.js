"use strict";(globalThis.webpackChunktimposu=globalThis.webpackChunktimposu||[]).push([[3839],{28453(a,e,n){n.d(e,{R:()=>s,x:()=>t});var i=n(96540);const l={},r=i.createContext(l);function s(a){const e=i.useContext(r);return i.useMemo(function(){return"function"==typeof a?a(e):{...e,...a}},[e,a])}function t(a){let e;return e=a.disableParentContext?"function"==typeof a.components?a.components(l):a.components||l:s(a.components),i.createElement(r.Provider,{value:e},a.children)}},92969(a,e,n){n.r(e),n.d(e,{assets:()=>d,contentTitle:()=>t,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"docker-image-advance/multistage-build","title":"Multi-Stage Build","description":"\ud83e\udd14 Apa itu Multi-Stage Build?","source":"@site/tutorial/docker/07-docker-image-advance/12-multistage-build.md","sourceDirName":"07-docker-image-advance","slug":"/docker-image-advance/multistage-build","permalink":"/docker/docker-image-advance/multistage-build","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12,"title":"Multi-Stage Build"},"sidebar":"tutorialSidebar","previous":{"title":"Dockerfile EXPOSE","permalink":"/docker/docker-image-advance/instruksi-expose"},"next":{"title":"Multiple Layered","permalink":"/docker/docker-image-advance/layered"}}');var l=n(74848),r=n(28453);const s={sidebar_position:12,title:"Multi-Stage Build"},t=void 0,d={},o=[{value:"\ud83e\udd14 Apa itu Multi-Stage Build?",id:"-apa-itu-multi-stage-build",level:2},{value:"\ud83d\udd25 Contoh Implementasi",id:"-contoh-implementasi",level:2},{value:"\ud83d\ude80 Contoh Implementasi di Spring Boot",id:"-contoh-implementasi-di-spring-boot",level:3},{value:"\u2696\ufe0f Perbandingan Hasil",id:"\ufe0f-perbandingan-hasil",level:3}];function c(a){const e={admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...a.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h2,{id:"-apa-itu-multi-stage-build",children:"\ud83e\udd14 Apa itu Multi-Stage Build?"}),"\n",(0,l.jsxs)(e.p,{children:["Docker ",(0,l.jsx)(e.strong,{children:"Multi-Stage Build"})," adalah teknik dalam pembuatan image Docker yang memungkinkan kita menggunakan beberapa tahap (stage) dalam satu Dockerfile. Setiap tahap dapat menggunakan image dasar (base image) yang berbeda, dan kita dapat menyalin artefak dari satu tahap ke tahap lainnya. Multi-Stage dapat meng-optimasi Dockerfile yang memisahkan tahap penyusunan kode (",(0,l.jsx)(e.em,{children:"build"}),") dari tahap eksekusi (",(0,l.jsx)(e.em,{children:"runtime"}),") untuk menghasilkan image yang jauh lebih kecil dan aman."]}),"\n",(0,l.jsx)(e.h2,{id:"-contoh-implementasi",children:"\ud83d\udd25 Contoh Implementasi"}),"\n",(0,l.jsx)(e.p,{children:"Berikut contoh penggunakan Multi-Stage build, dengan membagi proses build image menjadi 2 tahap:"}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Tahap Persiapan (Build Stage):"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Menggunakan image dasar yang lengkap dengan tools pengembangan."}),"\n",(0,l.jsx)(e.li,{children:"Melakukan instalasi dependensi dan kompilasi kode."}),"\n",(0,l.jsxs)(e.li,{children:["Menghasilkan artefak (misalnya file ",(0,l.jsx)(e.code,{children:".exe"}),", ",(0,l.jsx)(e.code,{children:".jar"}),", atau folder ",(0,l.jsx)(e.code,{children:"dist"}),")."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Tahap Akhir (Final Stage):"})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Menggunakan image dasar yang sangat minimal (hanya berisi OS ringan)."}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"Menyalin hanya file hasil kompilasi"})," dari tahap pertama."]}),"\n",(0,l.jsx)(e.li,{children:"Membuang semua file mentah dan tools kompilasi."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-dockerfile",children:'# Stage 1: Build\r\nFROM alpine:3.23.2 AS builder\r\n\r\nRUN apk add --no-cache openjdk25-jdk\r\n\r\nCOPY Hello.java Hello.java\r\nRUN javac Hello.java\r\n\r\n# Stage 2: Run\r\nFROM alpine:3.23.2\r\n\r\nRUN apk add --no-cache openjdk25-jre-headless\r\nCOPY --from=builder Hello.class .\r\nCMD ["java", "Hello"]\n'})}),"\n",(0,l.jsx)(e.admonition,{type:"info",children:(0,l.jsx)(e.p,{children:"Secara default, Docker tidak menghapus stage pertama begitu saja. Image tersebut disimpan di sistem penyimpanan lokal host sebagai cache."})}),"\n",(0,l.jsx)(e.h3,{id:"-contoh-implementasi-di-spring-boot",children:"\ud83d\ude80 Contoh Implementasi di Spring Boot"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-dockerfile",children:'# --- Stage 1: Build (Kompilasi) ---\r\nFROM maven:3.9.6-eclipse-temurin-17 AS build\r\nWORKDIR /app\r\n\r\n# Copy file konfigurasi dependency untuk caching\r\nCOPY pom.xml .\r\nRUN mvn dependency:go-offline\r\n\r\n# Copy source code dan lakukan build\r\nCOPY src ./src\r\nRUN mvn clean package -DskipTests\r\n\r\n# --- Stage 2: Runtime (Eksekusi) ---\r\nFROM eclipse-temurin:17-jre-alpine\r\nWORKDIR /app\r\n\r\n# Menyalin hasil build (.jar) dari tahap \'build\' ke stage ini\r\nCOPY --from=build /app/target/*.jar app.jar\r\n\r\n# Menjalankan aplikasi\r\nEXPOSE 8080\r\nENTRYPOINT ["java", "-jar", "app.jar"]\n'})}),"\n",(0,l.jsx)(e.p,{children:(0,l.jsx)(e.strong,{children:"Penjelasan Tiap Tahap"})}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:(0,l.jsx)(e.code,{children:"AS build"})}),": Memberikan nama alias pada tahap pertama agar hasilnya bisa dirujuk nanti."]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:(0,l.jsx)(e.code,{children:"mvn dependency:go-offline"})}),": Teknik untuk mempercepat build berikutnya dengan menyimpan layer library secara terpisah."]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:(0,l.jsx)(e.code,{children:"FROM eclipse-temurin:17-jre-alpine"})}),": Kita beralih ke image berbasis Alpine Linux yang sangat kecil dan hanya berisi JRE."]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:(0,l.jsx)(e.code,{children:"COPY --from=build"})}),": Inilah kuncinya. Kita mengambil file ",(0,l.jsx)(e.code,{children:".jar"})," dari tahap pertama, sementara semua file kode sumber (",(0,l.jsx)(e.code,{children:".java"}),") dan cache Maven ditinggalkan di tahap sebelumnya."]}),"\n"]}),"\n",(0,l.jsx)(e.h3,{id:"\ufe0f-perbandingan-hasil",children:"\u2696\ufe0f Perbandingan Hasil"}),"\n",(0,l.jsxs)(e.p,{children:["Jika kita menggunakan satu tahap saja (hanya JDK), ukuran image bisa mencapai ",(0,l.jsx)(e.strong,{children:"600MB - 800MB"}),". Dengan menggunakan multi-stage build dan JRE Alpine seperti contoh di atas, ukurannya bisa berkurang hingga menjadi sekitar ",(0,l.jsx)(e.strong,{children:"150MB - 200MB"}),"."]}),"\n",(0,l.jsx)(e.admonition,{type:"tip",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"Gunakan Eclipse Temurin sebagai distribusi OpenJDK yang paling direkomendasikan dan stabil untuk container."}),"\n",(0,l.jsxs)(e.li,{children:["Jika ingin keamanan lebih tinggi, gunakan image ",(0,l.jsx)(e.strong,{children:"Distroless"})," dari Google sebagai tahap kedua karena tidak memiliki ",(0,l.jsx)(e.em,{children:"shell"}),", sehingga meminimalkan celah peretasan."]}),"\n",(0,l.jsx)(e.li,{children:"Pantau dependensi Java Anda secara berkala menggunakan OWASP Dependency-Check untuk memastikan keamanan library yang digunakan."}),"\n"]})})]})}function u(a={}){const{wrapper:e}={...(0,r.R)(),...a.components};return e?(0,l.jsx)(e,{...a,children:(0,l.jsx)(c,{...a})}):c(a)}}}]);