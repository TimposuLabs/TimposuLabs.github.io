"use strict";(globalThis.webpackChunktimposu=globalThis.webpackChunktimposu||[]).push([[27245],{28453(e,n,a){a.d(n,{R:()=>r,x:()=>o});var t=a(96540);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}},28971(e,n,a){a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>k,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"java-unit-test/mocking","title":"Mocking","description":"Ketergantungan antar class","source":"@site/tutorial/java/java-unit-test/21-mocking.md","sourceDirName":"java-unit-test","slug":"/java-unit-test/mocking","permalink":"/java/java-unit-test/mocking","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":21,"frontMatter":{"sidebar_position":21,"title":"Mocking"},"sidebar":"tutorialSidebar","previous":{"title":"Paralel Test","permalink":"/java/java-unit-test/paralel-test"},"next":{"title":"Java Stream","permalink":"/java/java-stream/"}}');var i=a(74848),s=a(28453);const r={sidebar_position:21,title:"Mocking"},o=void 0,c={},l=[{value:"Ketergantungan antar class",id:"ketergantungan-antar-class",level:2},{value:"Pengenalan Mocking",id:"pengenalan-mocking",level:2},{value:"Mockito",id:"mockito",level:2},{value:"Menambahkan dependecy Mockito",id:"menambahkan-dependecy-mockito",level:3},{value:"Membuat Test Mock",id:"membuat-test-mock",level:3},{value:"Contoh Mocking Test",id:"contoh-mocking-test",level:2},{value:"Verifikasi Mocking",id:"verifikasi-mocking",level:2},{value:"Solusi = Menambahkan Verifikasi",id:"solusi--menambahkan-verifikasi",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"ketergantungan-antar-class",children:"Ketergantungan antar class"}),"\n",(0,i.jsx)(n.p,{children:"Saat membuat aplikasi yang besar, source code pun akan semakin besar, struktur class pun akan semakin kompleks. Kita tidak bisa memungkiri lagi bahwa akan ada ketergantungan antar class. Unit test yang bagus itu bisa terprediksi dan cukup mengetest ke satu function/method, jika harus mengetes interaksi antar class, lebih disarankan integration test. Lantas bagaimana jika kita harus mengetest class yang ketergantungan dengan class lain?. Solusinya adalah melakukan mocking terhadap dependency yang dibutuhkan class yang akan kita test."}),"\n",(0,i.jsx)(n.h2,{id:"pengenalan-mocking",children:"Pengenalan Mocking"}),"\n",(0,i.jsx)(n.p,{children:"Mocking sederhananya adalah membuat object tiruan. Hal ini dilakukan agar behavior object tersebut bisa kita tentukan sesuai dengan keinginan kita. Dengan mocking, kita bisa membuat request response seolah-olah object tersebut benar dibuat."}),"\n",(0,i.jsx)(n.h2,{id:"mockito",children:"Mockito"}),"\n",(0,i.jsx)(n.p,{children:"Ada banyak framework untuk melakukan mocking, namun di materi ini kita akan menggunakan Mockito. Mockito adalah salah satu mocking framework paling populer di Java, dan bisa digunakan juga untuk Kotlin. Mockito juga bisa diintegrasikan baik dengan JUnit"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://site.mockito.org/",children:"https://site.mockito.org/"})}),"\n",(0,i.jsx)(n.h3,{id:"menambahkan-dependecy-mockito",children:"Menambahkan dependecy Mockito"}),"\n",(0,i.jsxs)(n.p,{children:["Tambahkan dependecy Mockito di file ",(0,i.jsx)(n.code,{children:"pom.xml"}),", contoh versi yang digunakan ",(0,i.jsx)(n.code,{children:"5.15.2"}),", untuk versi baru dapat dilihat di repository Maven."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<dependency>\r\n\t<groupId>org.mockito</groupId>\r\n\t<artifactId>mockito-junit-jupiter</artifactId>\r\n\t<version>5.15.2</version>\r\n\t<scope>test</scope>\r\n</dependency>\n"})}),"\n",(0,i.jsx)(n.h3,{id:"membuat-test-mock",children:"Membuat Test Mock"}),"\n",(0,i.jsx)(n.p,{children:"Ketika membuat mock ada beberapa step:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Membuat Mock object."})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Menambahkan behavior ke Mock object."})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Test Mock."})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Verify Mock."})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Contoh:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public class DemoMockitoTest {\r\n\t\r\n\t@Test\r\n\tvoid testMock() {\r\n\t\t\r\n\t\t// Membuat Mock Object contoh membuat mock/object tiruan dari List\r\n\t\tList<String> list = Mockito.mock(List.class);\r\n\t\t\r\n\t\t// Menambahkan behaviour ke mock object\r\n\t\tMockito.when(list.get(0)).thenReturn("Ucup");\r\n\t\t\r\n\t\t// Test mock\r\n\t\tAssertions.assertEquals("Ucup", list.get(0));\r\n\t\tSystem.out.println(list.get(0));\r\n\t\t\r\n\t\t// Verify mock\r\n\t\t// melakukan verifikasi berapa kali method get(0) dipanggil, jika cocok maka test berhasil\r\n\t\t// Contoh: method get(0) hanya 2 kali dipanggil. Jika method get(0) dipanggil selain 2 kali maka test gagal\r\n\t\tMockito.verify(list, Mockito.times(2)).get(0);\r\n\t}\r\n\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"contoh-mocking-test",children:"Contoh Mocking Test"}),"\n",(0,i.jsxs)(n.p,{children:["Mockito memiliki ",(0,i.jsx)(n.code,{children:"MockitoExtention"})," yang bisa kita gunakan untuk integrasi dengan JUnit. Hal ini memudahkan kita ketika ingin membuat mock object, kita cukup gunakan ",(0,i.jsx)(n.code,{children:"@Mock"}),". Contoh kasus:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Kita punya sebuah class model dengan nama class ",(0,i.jsx)(n.code,{children:"Person(id: String, name: String)"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Selanjutnya kita punya interface ",(0,i.jsx)(n.code,{children:"PersonRepository"})," sebagai interaksi ke database, dan memiliki method ",(0,i.jsx)(n.code,{children:"selectById(id: String)"})," untuk melakukan mendapatkan data Person di database. Dan terakhir kita memiliki class ",(0,i.jsx)(n.code,{children:"PersonService"})," yang digunakan sebagai class bisnis logic, dimana di class tersebut kita akan coba gunakan ",(0,i.jsx)(n.code,{children:"PersonRepository"})," untuk mendapatkan data dari database, jika gagal, kita akan throw Exception yaitu ",(0,i.jsx)(n.code,{children:"IllegalArgumentException"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'mport org.junit.jupiter.api.Assertions;\r\nimport org.junit.jupiter.api.BeforeEach;\r\nimport org.junit.jupiter.api.Test;\r\nimport org.junit.jupiter.api.extension.ExtendWith;\r\nimport org.junit.jupiter.api.extension.Extensions;\r\nimport org.mockito.Mock;\r\nimport org.mockito.Mockito;\r\nimport org.mockito.junit.jupiter.MockitoExtension;\r\n\r\nimport com.timposulabs.belajar.data.Person;\r\nimport com.timposulabs.belajar.repository.PersonRepository;\r\nimport com.timposulabs.belajar.service.PersonService;\r\n\r\n@Extensions({\r\n\t@ExtendWith(MockitoExtension.class)\r\n})\r\npublic class DemoPersonServiceMockTest {\r\n\r\n\t@Mock\r\n\tprivate PersonRepository personRepository;\r\n\t\r\n\tprivate PersonService personService;\r\n\t\r\n\t@BeforeEach\r\n\tvoid setUp() {\r\n\t\tpersonService = new PersonService(personRepository);\r\n\t}\r\n\t\r\n\t@Test\r\n\tvoid testGetPersonNotFound() {\r\n\t\tAssertions.assertThrows(IllegalArgumentException.class, () -> {\r\n\t\t\tpersonService.get(0);\r\n\t\t});\r\n\t}\r\n\t\r\n\t@Test\r\n\tvoid testGetPersonSuccess() {\r\n\t\t// menambahkan behavior ke mock object\r\n\t\tMockito.when(personRepository.selectById(1))\r\n\t\t\t\t.thenReturn(new Person(1, "Ucup"));\r\n\t\t\r\n\t\tvar person = personService.get(1);\r\n\t\t\r\n\t\tAssertions.assertNotNull(person);\r\n\t\tAssertions.assertEquals(1, person.getId());\r\n\t\tAssertions.assertNotNull("Ucup", person.getNama());\r\n\t}\r\n\t\r\n\t@Test\r\n\tvoid testCreatePersonSuccess() {\r\n\t\tvar person = personService.create("Ucup");\r\n\t\t\r\n\t\tAssertions.assertNotNull(person);\r\n\t\tAssertions.assertEquals("Ucup", person.getNama());\r\n\t\tAssertions.assertNotNull(person.getId());\r\n\t\t\r\n\t\t// Verifikasi: pastikan setiap selesai memanggil mocking object pastikan melakukan verifikasi, untuk \r\n\t\t// memastikan setiap method dalam mocking object telah dipanggil, dan berapa kali dipanggil.\r\n\t\tMockito.verify(personRepository, Mockito.times(1))\r\n\t\t\t\t.insert(new Person(person.getId(), "Ucup"));\r\n\t}\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"verifikasi-mocking",children:"Verifikasi Mocking"}),"\n",(0,i.jsx)(n.p,{children:"Pada contoh sebelumnya, kita tidak melakukan verifikasi terhadap object mocking, apakah dipanggil atau tidak. Pada kasus sebelumnya mungkin tidak terlalu berguna karena kebetulan method nya mengembalikan value, sehingga kalo kita lupa memanggil method nya, sudah pasti unit test nya gagal. Lantas bagaimana jika method nya tidak mengembalikan value? Alias method unit. Contoh kasus kita akan melanjutkan kasus sebelumnya:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Di interface ",(0,i.jsx)(n.code,{children:"PersonRepository"})," kita akan membuat method ",(0,i.jsx)(n.code,{children:"insert(person: Person)"})," yang digunakan untuk menyimpan data ke database, namun tidak mengembalikan value, alias void."]}),"\n",(0,i.jsxs)(n.li,{children:["Di class ",(0,i.jsx)(n.code,{children:"PersonService"})," kita akan membuat method ",(0,i.jsx)(n.code,{children:"register(name: String)"})," dimana akan membuat object Person dengan id random, lalu menyimpan ke database via ",(0,i.jsx)(n.code,{children:"PersonRepository"}),", lalu mengembalikan object person tersebut."]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Repository"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"import com.timposulabs.belajar.data.Person;\r\n\r\npublic interface PersonRepository {\r\n\r\n\tPerson selectById(int id);\r\n\t\r\n\tvoid insert(Person person);\r\n\t\r\n}\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Pada class Service"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public Person create(String name) {\r\n\tvar person = new Person(new Random().nextInt(100), name); // generate random range 0 - 99\r\n\trepository.insert(person);\r\n\treturn person;\r\n}\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"JUnit Test"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'void testCreatePersonSuccess() {\r\n\tvar person = personService.create("Ucup");\r\n\r\n\tAssertions.assertNotNull(person);\r\n\tAssertions.assertEquals("Ucup", person.getNama());\r\n\tAssertions.assertNotNull(person.getId());\r\n}\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["Pada test di atas sebenarnya ada yang salah. Kalau kita hapus kode ",(0,i.jsx)(n.code,{children:"personRepository.insert(person)"})," pada class Service, maka unit test nya pun tetap sukses. Hal ini terjadi karena, kita tidak melakukan verifikasi bahwa mocking object dipanggil. Hal ini sangat berbahaya, karena jika code sampai naik ke production, bisa jadi create datanya  sukses, tapi tidak masuk ke database."]})}),"\n",(0,i.jsx)(n.h3,{id:"solusi--menambahkan-verifikasi",children:"Solusi = Menambahkan Verifikasi"}),"\n",(0,i.jsx)(n.p,{children:"Untuk mengatasi problem di atas kita perlu menambahkan verifikasi Mock."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Test\r\nvoid testCreatePersonSuccess() {\r\n\tvar person = personService.create("Ucup");\r\n\t\r\n\tAssertions.assertNotNull(person);\r\n\tAssertions.assertEquals("Ucup", person.getNama());\r\n\tAssertions.assertNotNull(person.getId());\r\n\t\r\n\t// Verifikasi: pastikan setiap selesai memanggil mocking object pastikan melakukan verifikasi, untuk \r\n\t// memastikan setiap method dalam mocking object telah dipanggil, dan berapa kali dipanggil.\r\n\tMockito.verify(personRepository, Mockito.times(1))\r\n\t\t\t.insert(new Person(person.getId(), "Ucup"));\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Melakukan verifikasi akan memastikan setiap method yang di-mocking telah dipanggil dan berapa kali dia dipanggil."})]})}function k(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);