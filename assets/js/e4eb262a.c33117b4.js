"use strict";(globalThis.webpackChunktimposu=globalThis.webpackChunktimposu||[]).push([[6670],{28453(t,n,e){e.d(n,{R:()=>i,x:()=>d});var r=e(96540);const a={},s=r.createContext(a);function i(t){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof t?t(n):{...n,...t}},[n,t])}function d(t){let n;return n=t.disableParentContext?"function"==typeof t.components?t.components(a):t.components||a:i(t.components),r.createElement(s.Provider,{value:n},t.children)}},81786(t,n,e){e.d(n,{A:()=>r});const r=e.p+"assets/images/many-to-many-6aa81602769493b1c2929977a8044fb9.png"},84438(t,n,e){e.r(n),e.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>l,frontMatter:()=>i,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"springboot/springboot-jpa-hibernate/many-to-many-read","title":"Many-to-Many Read","description":"Hibernate","source":"@site/tutorial/spring/springboot/springboot-jpa-hibernate/24-many-to-many-read.md","sourceDirName":"springboot/springboot-jpa-hibernate","slug":"/springboot/springboot-jpa-hibernate/many-to-many-read","permalink":"/spring/springboot/springboot-jpa-hibernate/many-to-many-read","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":24,"frontMatter":{"sidebar_position":24,"title":"Many-to-Many Read"},"sidebar":"tutorialSidebar","previous":{"title":"Many-to-Many Create","permalink":"/spring/springboot/springboot-jpa-hibernate/many-to-many-create"},"next":{"title":"Many-to-Many Update","permalink":"/spring/springboot/springboot-jpa-hibernate/many-to-many-update"}}');var a=e(74848),s=e(28453);const i={sidebar_position:24,title:"Many-to-Many Read"},d=void 0,o={},u=[{value:"\ud83d\udcaa Tantangan Utama: Lazy Loading",id:"-tantangan-utama-lazy-loading",level:2},{value:"\u2705 Solusi: Menggunakan HQL dengan JOIN FETCH (Sangat Direkomendasikan)",id:"-solusi-menggunakan-hql-dengan-join-fetch-sangat-direkomendasikan",level:2},{value:"\ud83d\ude80 Implementasi Entity",id:"-implementasi-entity",level:2},{value:"1\ufe0f\u20e3 Entity <code>Student</code> (Sisi Owner)",id:"1\ufe0f\u20e3-entity-student-sisi-owner",level:3},{value:"2\ufe0f\u20e3 Entity <code>Course</code> (Sisi Inverse)",id:"2\ufe0f\u20e3-entity-course-sisi-inverse",level:3},{value:"\ud83d\udee2 Implementasi DAO",id:"-implementasi-dao",level:2},{value:"\u25b6\ufe0f Main Class",id:"\ufe0f-main-class",level:2}];function c(t){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...t.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Hibernate",src:e(81786).A+"",width:"835",height:"236"})}),"\n",(0,a.jsx)(n.h2,{id:"-tantangan-utama-lazy-loading",children:"\ud83d\udcaa Tantangan Utama: Lazy Loading"}),"\n",(0,a.jsxs)(n.p,{children:["Secara default, relasi ",(0,a.jsx)(n.code,{children:"@ManyToMany"})," di Hibernate bersifat ",(0,a.jsx)(n.strong,{children:"LAZY"}),". Artinya, saat kita mengambil data ",(0,a.jsx)(n.code,{children:"Student"}),", Hibernate tidak akan mengambil data ",(0,a.jsx)(n.code,{children:"Course"})," sampai kita memanggilnya (",(0,a.jsx)(n.code,{children:"student.getCourses()"}),")."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Permasalahannya"}),": Jika Session sudah ditutup sebelum kita memanggil daftar kursus (",(0,a.jsx)(n.code,{children:"Course"}),"), maka akan muncul error ",(0,a.jsx)(n.code,{children:"LazyInitializationException"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"-solusi-menggunakan-hql-dengan-join-fetch-sangat-direkomendasikan",children:"\u2705 Solusi: Menggunakan HQL dengan JOIN FETCH (Sangat Direkomendasikan)"}),"\n",(0,a.jsxs)(n.p,{children:["Teknik ini memaksa Hibernate untuk mengambil data Siswa dan Kursus dalam ",(0,a.jsx)(n.strong,{children:"satu query SQL"})," saja. Ini adalah cara paling efisien untuk menghindari masalah ",(0,a.jsx)(n.strong,{children:"N+1"}),"."]}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsxs)(n.p,{children:["Baca: ",(0,a.jsx)(n.a,{href:"/spring/springboot/springboot-jpa-hibernate/eager-lazy",children:(0,a.jsx)(n.strong,{children:"Eager vs Lazy"})})]})}),"\n",(0,a.jsx)(n.h2,{id:"-implementasi-entity",children:"\ud83d\ude80 Implementasi Entity"}),"\n",(0,a.jsxs)(n.h3,{id:"1\ufe0f\u20e3-entity-student-sisi-owner",children:["1\ufe0f\u20e3 Entity ",(0,a.jsx)(n.code,{children:"Student"})," (Sisi Owner)"]}),"\n",(0,a.jsxs)(n.p,{children:['Sisi "Owner" adalah entitas yang menentukan konfigurasi tabel penghubung menggunakan ',(0,a.jsx)(n.code,{children:"@JoinTable"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@Entity\r\n@Table(name = "student")\r\npublic class Student {\r\n\r\n\t@Id\r\n\t@GeneratedValue(strategy = GenerationType.IDENTITY)\r\n\tprivate Integer id;\r\n\t\r\n\t@Column(name = "first_name")\r\n\tprivate String firstName;\r\n\t\r\n\t@Column(name = "last_name")\r\n\tprivate String lastName;\r\n\t\r\n\t@ManyToOne(cascade = {CascadeType.DETACH, CascadeType.MERGE, CascadeType.PERSIST, CascadeType.REFRESH})\r\n\t@JoinColumn(name = "class_id")\r\n\tprivate Classes classes;\r\n\t\r\n\t@OneToMany(\r\n\t\t\tfetch = FetchType.LAZY,\r\n\t\t\tcascade = CascadeType.ALL)\r\n\t@JoinColumn(name = "student_id") // FK yang akan dibuat di tabel \'grade\'\r\n\tprivate List<Grade> grades = new ArrayList<>();\r\n\t\r\n\t@ManyToMany(\r\n\t\t\tfetch = FetchType.LAZY,\r\n\t\t\tcascade = {CascadeType.DETACH, CascadeType.MERGE, CascadeType.PERSIST, CascadeType.REFRESH})\r\n\t@JoinTable(\r\n\t\t\tname = "course_student",\r\n\t\t\tjoinColumns = @JoinColumn(name = "student_id"),\r\n\t\t\tinverseJoinColumns = @JoinColumn(name = "course_id"))\r\n\tprivate Set<Course> courses = new HashSet<>();\r\n\t\r\n\tpublic Student() {\t\t\r\n\t}\r\n\r\n\tpublic Student(String firstName, String lastName) {\r\n\t\tthis.firstName = firstName;\r\n\t\tthis.lastName = lastName;\r\n\t}\r\n\r\n\tpublic Integer getId() {\r\n\t\treturn id;\r\n\t}\r\n\r\n\tpublic void setId(Integer id) {\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tpublic String getFirstName() {\r\n\t\treturn firstName;\r\n\t}\r\n\r\n\tpublic void setFirstName(String firstName) {\r\n\t\tthis.firstName = firstName;\r\n\t}\r\n\r\n\tpublic String getLastName() {\r\n\t\treturn lastName;\r\n\t}\r\n\r\n\tpublic void setLastName(String lastName) {\r\n\t\tthis.lastName = lastName;\r\n\t}\r\n\t\r\n\tpublic Classes getClasses() {\r\n\t\treturn classes;\r\n\t}\r\n\r\n\tpublic void setClasses(Classes classes) {\r\n\t\tthis.classes = classes;\r\n\t}\r\n\r\n\tpublic List<Grade> getGrades() {\r\n\t\treturn grades;\r\n\t}\r\n\r\n\tpublic void setGrades(List<Grade> grades) {\r\n\t\tthis.grades = grades;\r\n\t}\r\n\r\n\tpublic void addGrade(Grade grade) {\r\n\t\tif (grades == null) {\r\n\t\t\tgrades = new ArrayList<>();\r\n\t\t}\r\n\t\t\r\n\t\tgrades.add(grade);\r\n\t}\r\n\t\r\n\tpublic Set<Course> getCourses() {\r\n\t\treturn courses;\r\n\t}\r\n\r\n\tpublic void setCourses(Set<Course> courses) {\r\n\t\tthis.courses = courses;\r\n\t}\r\n\t\r\n\tpublic void addCourse(Course course) {\r\n\t\tif (course == null) return;\r\n\t\t\r\n\t\tif (courses == null) {\r\n\t\t\tcourses = new HashSet<>();\r\n\t\t}\r\n\t\t\r\n\t\tif (!courses.contains(course)) {\r\n\t\t\tcourses.add(course);\r\n\t\t\tcourse.addStudent(this);\r\n\t\t}\r\n\t}\r\n\r\n\t@Override\r\n\tpublic String toString() {\r\n\t\treturn "Student [id=" + id + ", firstName=" + firstName + ", lastName=" + lastName + "]";\r\n\t}\r\n}\n'})}),"\n",(0,a.jsxs)(n.h3,{id:"2\ufe0f\u20e3-entity-course-sisi-inverse",children:["2\ufe0f\u20e3 Entity ",(0,a.jsx)(n.code,{children:"Course"})," (Sisi Inverse)"]}),"\n",(0,a.jsxs)(n.p,{children:["Sisi ini menggunakan atribut ",(0,a.jsx)(n.code,{children:"mappedBy"})," yang merujuk pada nama variabel di class ",(0,a.jsx)(n.code,{children:"Student"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@Entity\r\n@Table(name = "course")\r\npublic class Course {\r\n\r\n\t@Id\r\n\t@GeneratedValue(strategy = GenerationType.IDENTITY)\r\n\tprivate Integer id;\r\n\t\r\n\t@Column(name = "course_name")\r\n\tprivate String courseName;\r\n\t\r\n\t@ManyToMany(\r\n\t\t\tmappedBy = "courses",\r\n\t\t\tfetch = FetchType.LAZY,\r\n\t\t\tcascade = {CascadeType.DETACH, CascadeType.MERGE, CascadeType.PERSIST, CascadeType.REFRESH})\r\n\tprivate Set<Student> students = new HashSet<>();\r\n\t\r\n\tpublic Course() { }\r\n\t\r\n\tpublic Course(String courseName) {\r\n\t\tthis.courseName = courseName;\r\n\t}\r\n\r\n\tpublic Integer getId() {\r\n\t\treturn id;\r\n\t}\r\n\r\n\tpublic void setId(Integer id) {\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tpublic String getCourseName() {\r\n\t\treturn courseName;\r\n\t}\r\n\r\n\tpublic void setCourseName(String courseName) {\r\n\t\tthis.courseName = courseName;\r\n\t}\r\n\t\r\n\tpublic Set<Student> getStudents() {\r\n\t\treturn students;\r\n\t}\r\n\r\n\tpublic void setStudents(Set<Student> students) {\r\n\t\tthis.students = students;\r\n\t}\r\n\r\n\tpublic void addStudent(Student student) {\r\n\t\tif (student == null) return;\r\n\t\t\r\n\t\tif (students == null) {\r\n\t\t\tstudents = new HashSet<>();\r\n\t\t}\r\n\t\t\r\n\t\tif (!students.contains(student)) {\r\n\t\t\tstudents.add(student);\r\n\t\t\tstudent.addCourse(this);\r\n\t\t}\r\n\t}\r\n\r\n\t@Override\r\n\tpublic String toString() {\r\n\t\treturn "Course [id=" + id + ", courseName=" + courseName + "]";\r\n\t}\r\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"-implementasi-dao",children:"\ud83d\udee2 Implementasi DAO"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Membuat Interface DAO:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"public interface SchoolDAO {\r\n\t\r\n\tStudent findStudentAndCourseByStudentId(Integer id);\r\n\t\r\n\tCourse findCourseAndStudentByCourseId(Integer id);\r\n\t\r\n}\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Implementasi DAO simpan ",(0,a.jsx)(n.code,{children:"Student"})," sekaligus dengan ",(0,a.jsx)(n.code,{children:"Course"}),"-nya:"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@Repository\r\npublic class SchoolDAOImpl implements SchoolDAO {\r\n\r\n\tprivate EntityManager entityManager;\r\n\t\r\n\tpublic SchoolDAOImpl(EntityManager entityManager) {\r\n\t\tthis.entityManager = entityManager;\r\n\t}\r\n\r\n\t@Override\r\n\t@Transactional(readOnly = true)\r\n\tpublic Student findStudentAndCourseByStudentId(Integer id) {\r\n\t\tTypedQuery<Student> query = entityManager.createQuery(\r\n\t\t\t\t"SELECT s FROM Student s "\r\n\t\t\t\t+ "JOIN FETCH s.courses "\r\n\t\t\t\t+ "WHERE s.id = :id", Student.class);\r\n\t\tquery.setParameter("id", id);\r\n\t\t\r\n\t\tStudent student = query.getSingleResult();\r\n\t\t\r\n\t\treturn student;\r\n\t}\r\n\t\r\n\t@Override\r\n\t@Transactional(readOnly = true)\r\n\tpublic Course findCourseAndStudentByCourseId(Integer id) {\r\n\t\tTypedQuery<Course> query = entityManager.createQuery(\r\n\t\t\t\t"SELECT c FROM Course c "\r\n\t\t\t\t+ "JOIN FETCH c.students "\r\n\t\t\t\t+ "WHERE c.id = :id", Course.class);\r\n\t\tquery.setParameter("id", id);\r\n\t\t\r\n\t\tCourse course = query.getSingleResult();\r\n\t\t\r\n\t\treturn course;\r\n\t}\r\n\t\r\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\ufe0f-main-class",children:"\u25b6\ufe0f Main Class"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Kita akan membuat read data ",(0,a.jsx)(n.code,{children:"Student"})," beserta ",(0,a.jsx)(n.code,{children:"Course"}),"-nya. Contoh kasus menampilkan data ",(0,a.jsx)(n.code,{children:"Course"})," beserta data ",(0,a.jsx)(n.code,{children:"Student"})," terkait berdasarkan ",(0,a.jsx)(n.code,{children:"Course"})," dengan id 4 (",(0,a.jsx)(n.code,{children:"findCourseAndStudent"}),") dan menampilkan data ",(0,a.jsx)(n.code,{children:"Student"})," beserta ",(0,a.jsx)(n.code,{children:"Course"})," terkait berdasarkan ",(0,a.jsx)(n.code,{children:"Student"})," dengan id 6 (",(0,a.jsx)(n.code,{children:"findStudentAndCourse"}),")."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@SpringBootApplication\r\npublic class Application {\r\n\r\n\tpublic static void main(String[] args) {\r\n\t\tSpringApplication.run(Application.class, args);\r\n\t}\r\n\r\n\t// Bean ini akan dieksekusi di command line\r\n\t@Bean\r\n\tpublic CommandLineRunner commandLineRunner(SchoolDAO dao) {\r\n\t\treturn runner -> {\r\n\r\n\t\t\tfindStudentAndCourse(dao);\r\n\t\t\t\r\n\t\t\tfindCourseAndStudent(dao);\r\n\t\t};\r\n\t}\r\n\r\n\tprivate void findCourseAndStudent(SchoolDAO dao) {\r\n\t\tint id = 4;\r\n\t\tCourse course = dao.findCourseAndStudentByCourseId(id);\r\n\t\t\r\n\t\tSystem.out.println("Load course: " + course);\r\n\t\tSystem.out.println("student of course: : " + course.getStudents());\r\n\t}\r\n\r\n\tprivate void findStudentAndCourse(SchoolDAO dao) {\r\n\t\tint id = 6;\r\n\t\tStudent student = dao.findStudentAndCourseByStudentId(id);\r\n\t\t\r\n\t\tSystem.out.println("Load student: " + student);\r\n\t\tSystem.out.println("student course: " + student.getCourses());\r\n\t}\r\n}\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Contoh output Hibernate:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Hibernate: select s1_0.id,s1_0.class_id,c1_0.student_id,c1_1.id,c1_1.course_name,s1_0.first_name,s1_0.last_name from student s1_0 join course_student c1_0 on s1_0.id=c1_0.student_id join course c1_1 on c1_1.id=c1_0.course_id where s1_0.id=?\r\nLoad student: Student [id=6, firstName=Abu, lastName=Nawas]\r\nstudent course: [Course [id=1, courseName=Bahasa Arab], Course [id=2, courseName=Sejarah]]\r\nHibernate: select c1_0.id,c1_0.course_name,s1_0.course_id,s1_1.id,s1_1.class_id,s1_1.first_name,s1_1.last_name from course c1_0 join course_student s1_0 on c1_0.id=s1_0.course_id join student s1_1 on s1_1.id=s1_0.student_id where c1_0.id=?\r\nLoad course: Course [id=4, courseName=Bahasa Arab]\r\nstudent of course: : [Student [id=7, firstName=Abu, lastName=Jahal]]\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Source Code"}),": ",(0,a.jsx)(n.a,{href:"https://github.com/TimposuLabs/belajar-springboot-jpa-hibernate-advance/tree/main/14-hibernate-many-to-many-get-data",children:"https://github.com/TimposuLabs/belajar-springboot-jpa-hibernate-advance/tree/main/14-hibernate-many-to-many-get-data"})]})})]})}function l(t={}){const{wrapper:n}={...(0,s.R)(),...t.components};return n?(0,a.jsx)(n,{...t,children:(0,a.jsx)(c,{...t})}):c(t)}}}]);